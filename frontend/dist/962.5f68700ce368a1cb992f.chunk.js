"use strict";(self.webpackChunktime_tracking_system_frontend=self.webpackChunktime_tracking_system_frontend||[]).push([[962],{3661:(e,t,r)=>{r.d(t,{DG:()=>y,Oc:()=>d,Y$:()=>p,aJ:()=>u,ap:()=>x,ax:()=>l,b$:()=>g,bV:()=>m,is:()=>f,l3:()=>h,w$:()=>b,z9:()=>v});var a=r(1083),n=function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))},o=function(e,t){var r,a,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},s=function(e,t,r){if(r||2===arguments.length)for(var a,n=0,o=t.length;n<o;n++)!a&&n in t||(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},i=a.A.create({baseURL:"/api",timeout:3e4}),c=function(e,t){if(console.error("API Error:",e),a.A.isAxiosError(e)){var r=e;if(r.response){var n=r.response.data,o=n&&"object"==typeof n?n.error||n.message||JSON.stringify(n):"Ошибка сервера";throw new Error("".concat(t||"Ошибка API",": ").concat(o))}throw r.request?new Error("Сервер не отвечает. Проверьте соединение с интернетом"):new Error("Ошибка при выполнении запроса: ".concat(r.message))}throw new Error(t||"Неизвестная ошибка при запросе к API")},l=function(){return n(void 0,void 0,void 0,(function(){var e,t,r;return o(this,(function(a){switch(a.label){case 0:return console.log("Запрос отделов начат"),[4,i.get("/departments")];case 1:return e=a.sent(),console.log("Получен ответ по отделам:",e.data),t=e.data.items,console.log("Отделы (массив):",t),r=t.filter((function(e,t,r){return t===r.findIndex((function(t){return t.id===e.id}))})),console.log("Уникальные отделы после фильтрации:",r),[2,r]}}))}))},d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(void 0,s([],e,!0),void 0,(function(e,t,r,a,n){var s;return void 0===e&&(e=1),void 0===t&&(t=20),o(this,(function(o){switch(o.label){case 0:return s={page:e,per_page:t},r&&(s.department_id=r),void 0!==a&&(s.is_active=a),n&&(s.search=n),[4,i.get("/employees",{params:s})];case 1:return[2,o.sent().data]}}))}))},u=function(){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,i.get("/employees/with-open-records")];case 1:return[2,e.sent().data.items||[]]}}))}))},h=function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,i.get("/employees/".concat(e))];case 1:return[2,t.sent().data]}}))}))},m=function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,i.post("/employees",e)];case 1:return[2,t.sent().data]}}))}))},p=function(e,t){return n(void 0,void 0,void 0,(function(){var r,a;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),console.log("Updating employee with data:",t),[4,i.put("/employees/".concat(e),t)];case 1:return r=n.sent(),console.log("Employee update response:",r.data),[2,r.data];case 2:throw a=n.sent(),console.error("Error updating employee:",a),a;case 3:return[2]}}))}))},b=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(void 0,s([],e,!0),void 0,(function(e,t,r,a,n){var s;return void 0===e&&(e=1),void 0===t&&(t=20),o(this,(function(o){switch(o.label){case 0:return s={page:e,per_page:t},r&&(s.employee_id=r),a&&(s.start_date=a),n&&(s.end_date=n),[4,i.get("/time-records",{params:s})];case 1:return[2,o.sent().data]}}))}))},f=function(e,t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,i.post("/time-records/check-in",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},g=function(e,t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,i.post("/time-records/check-out",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},y=function(e,t){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];return n(void 0,s([e,t],r,!0),void 0,(function(e,t,r,a){var n,s,l;return void 0===r&&(r="employee"),o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n={start_date:e,end_date:t,group_by:r},a&&(n.department_id=a),console.log("Request params for summary report:",n),[4,i.get("/reports/summary",{params:n})];case 1:if(s=o.sent(),console.log("Summary report API response:",s.data),!s.data||!s.data.period||!s.data.data)throw new Error("Неверный формат ответа от сервера");return[2,s.data];case 2:throw l=o.sent(),c(l,"Ошибка при получении сводного отчета"),l;case 3:return[2]}}))}))},x=function(e,t,r){return n(void 0,void 0,void 0,(function(){var a,n,s;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),a={date:e},t&&(a.employee_id=t),r&&(a.department_id=r),console.log("Request params for daily report:",a),[4,i.get("/reports/daily",{params:a})];case 1:if(n=o.sent(),console.log("Daily report API response:",n.data),!n.data||!n.data.date||!n.data.records)throw new Error("Неверный формат ответа от сервера");return[2,n.data];case 2:throw s=o.sent(),c(s,"Ошибка при получении ежедневного отчета"),s;case 3:return[2]}}))}))},v=function(e,t){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];return n(void 0,s([e,t],r,!0),void 0,(function(e,t,r,a){var n,s,l;return void 0===r&&(r="summary"),o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n={start_date:e,end_date:t,type:r},a&&(n.department_id=a),console.log("Request params for CSV export:",n),[4,i.get("/reports/export/csv",{params:n})];case 1:if(s=o.sent(),console.log("CSV export response received"),!s.data||!s.data.csv_data||!s.data.filename)throw new Error("Неверный формат ответа от сервера при экспорте CSV");return[2,s.data];case 2:throw l=o.sent(),c(l,"Ошибка при экспорте CSV"),l;case 3:return[2]}}))}))}},5739:(e,t,r)=>{r.d(t,{EU:()=>n,Nl:()=>a,Qn:()=>o,V9:()=>s});var a=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Europe/Moscow"}).format(t)},n=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"Europe/Moscow"}).format(t)},o=function(){return(new Date).toLocaleDateString("ru-RU",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"Europe/Moscow"})},s=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Europe/Moscow"}).format(t)}},6962:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var a=r(4848),n=r(6540),o=r(3661),s=r(5739),i=r(5708),c=r(5463),l={а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"j",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"h",ц:"ts",ч:"ch",ш:"sh",щ:"sch",ъ:"",ы:"y",ь:"",э:"e",ю:"yu",я:"ya",А:"A",Б:"B",В:"V",Г:"G",Д:"D",Е:"E",Ё:"Yo",Ж:"Zh",З:"Z",И:"I",Й:"J",К:"K",Л:"L",М:"M",Н:"N",О:"O",П:"P",Р:"R",С:"S",Т:"T",У:"U",Ф:"F",Х:"H",Ц:"Ts",Ч:"Ch",Ш:"Sh",Щ:"Sch",Ъ:"",Ы:"Y",Ь:"",Э:"E",Ю:"Yu",Я:"Ya"};function d(e){return e?e.split("").map((function(e){return l[e]||e})).join(""):""}var u=function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))},h=function(e,t){var r,a,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(r=1,a&&(n=2&i[0]?a.return:i[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,i[1])).done)return n;switch(a=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,a=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){o.label=i[1];break}if(6===i[0]&&o.label<n[1]){o.label=n[1],n=i;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(i);break}n[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],a=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},m=function(e,t){if(void 0===t&&(t=2),null==e)return"0.00";var r="number"==typeof e?e:parseFloat(String(e));if(isNaN(r))return console.warn("Invalid number value:",e),"0.00";Math.abs(r)>1e4&&(console.warn("Extremely large number detected, might be formatting issue:",r),r=Math.abs(r)/1e7),r=Math.abs(r);try{return r.toFixed(t)}catch(e){return console.error("Error formatting number:",e),"0.00"}};const p=function(){var e=(0,n.useState)(!1),t=e[0],r=e[1],l=(0,n.useState)(null),p=l[0],b=l[1],f=(0,n.useState)("summary"),g=f[0],y=f[1],x=(0,n.useState)(""),v=x[0],j=x[1],_=(0,n.useState)(""),w=_[0],N=_[1],S=(0,n.useState)(""),k=S[0],M=S[1],E=(0,n.useState)("employee"),C=E[0],F=E[1],D=(0,n.useState)(""),I=D[0],A=D[1],O=(0,n.useState)(null),V=O[0],U=O[1],T=(0,n.useState)(null),z=T[0],R=T[1],P=(0,n.useState)([]),Y=P[0],Z=P[1],G=(0,n.useState)(!1),q=G[0],B=G[1],L=(0,n.useState)(!1),H=L[0],J=L[1],$=(0,n.useState)(null),K=$[0],Q=$[1];(0,n.useRef)(null),(0,n.useEffect)((function(){u(void 0,void 0,void 0,(function(){var e,t;return h(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,(0,o.ax)()];case 1:return e=r.sent(),Z(e),[3,3];case 2:return t=r.sent(),console.error("Ошибка при загрузке отделов:",t),[3,3];case 3:return[2]}}))}));var e=new Date,t=new Date(e);t.setMonth(t.getMonth()-1),N(W(e)),j(W(t)),M(W(e))}),[]);var W=function(e){return e.toISOString().split("T")[0]},X=function(){if("summary"===g){if(!v||!w)return b("Необходимо указать начальную и конечную даты"),!1;var e=new Date(v),t=new Date(w);if(e>t)return b("Начальная дата не может быть позже конечной даты"),!1;if(Math.ceil((t.getTime()-e.getTime())/864e5)>366)return b("Период отчета не может превышать 366 дней"),!1}else if(!k)return b("Необходимо указать дату для ежедневного отчета"),!1;return!0},ee=function(e,t){try{if("summary"===t){if(!e||"object"!=typeof e)return console.error("Report is not an object:",e),!1;if(!e.period||!e.period.start_date||!e.period.end_date)return console.error("Report period is invalid:",e.period),!1;if(!e.data||!Array.isArray(e.data))return console.error("Report data is not an array:",e.data),!1;if(!e.group_by||!["employee","department","date"].includes(e.group_by))return console.error("Report group_by is invalid:",e.group_by),!1;if(0===e.data.length)return!0;console.log("Checking report item structure:",e.data[0]),e.data.forEach((function(t,r){if(void 0!==t.total_hours)if("number"!=typeof t.total_hours)try{var a=parseFloat(String(t.total_hours));isNaN(a)?(console.warn("Invalid total_hours value at index ".concat(r,":"),t.total_hours),e.data[r].total_hours=0):Math.abs(a)>1e4?(e.data[r].total_hours=Math.abs(a)/1e7,console.log("Normalized large total_hours value at index ".concat(r," from ").concat(a," to ").concat(e.data[r].total_hours))):e.data[r].total_hours=Math.abs(a)}catch(t){console.error("Error converting total_hours at index ".concat(r,":"),t),e.data[r].total_hours=0}else Math.abs(t.total_hours)>1e4?(e.data[r].total_hours=Math.abs(t.total_hours)/1e7,console.log("Normalized existing large total_hours value at index ".concat(r," from ").concat(t.total_hours," to ").concat(e.data[r].total_hours))):e.data[r].total_hours=Math.abs(t.total_hours);else console.warn("Missing total_hours at index ".concat(r)),e.data[r].total_hours=0;if(void 0!==t.record_count)if("number"!=typeof t.record_count)try{var n=parseInt(String(t.record_count),10);isNaN(n)?(console.warn("Invalid record_count value at index ".concat(r,":"),t.record_count),e.data[r].record_count=0):e.data[r].record_count=Math.abs(n)}catch(t){console.error("Error converting record_count at index ".concat(r,":"),t),e.data[r].record_count=0}else e.data[r].record_count=Math.abs(t.record_count);else console.warn("Missing record_count at index ".concat(r)),e.data[r].record_count=0}));var r=e.data[0];switch(e.group_by){case"employee":if(!("employee_name"in r))return console.error("Missing employee_name in employee grouped data:",r),!1;break;case"department":if(!("department_name"in r))return console.error("Missing department_name in department grouped data:",r),!1;break;case"date":if(!("date"in r)){console.error("Missing date in date grouped data:",r),console.warn("Trying to fix missing date field by adding current date to each record");var a=(new Date).toISOString().split("T")[0];e.data.forEach((function(t,r){e.data[r].date=a})),console.log("Added date field to all records:",a)}}return console.log("Validated and converted report data:",e.data),!0}if("daily"===t){if(!e||"object"!=typeof e)return console.error("Daily report is not an object:",e),!1;if(!e.date)return console.error("Daily report has no date:",e),!1;if(!e.records||!Array.isArray(e.records))return console.error("Daily report records is not an array:",e.records),!1;if(e.records.length>0){var n=e.records[0];if(!n.id||!n.employee_name||!n.check_in||"number"!=typeof n.duration_hours)return console.error("Invalid daily report record:",n),!1}return e.records&&Array.isArray(e.records)&&e.records.forEach((function(t,r){if(void 0!==t.duration_hours)if("number"!=typeof t.duration_hours)try{var a=parseFloat(String(t.duration_hours));isNaN(a)?(console.warn("Invalid duration_hours value at index ".concat(r,":"),t.duration_hours),e.records[r].duration_hours=0):Math.abs(a)>1e4?(e.records[r].duration_hours=Math.abs(a)/1e7,console.log("Normalized large duration_hours value at index ".concat(r," from ").concat(a," to ").concat(e.records[r].duration_hours))):e.records[r].duration_hours=Math.abs(a)}catch(t){console.error("Error converting duration_hours at index ".concat(r,":"),t),e.records[r].duration_hours=0}else Math.abs(t.duration_hours)>1e4?(e.records[r].duration_hours=Math.abs(t.duration_hours)/1e7,console.log("Normalized existing large duration_hours value at index ".concat(r," from ").concat(t.duration_hours," to ").concat(e.records[r].duration_hours))):e.records[r].duration_hours=Math.abs(t.duration_hours);else console.warn("Missing duration_hours at index ".concat(r)),e.records[r].duration_hours=0})),!0}return!1}catch(e){return console.error("Error processing report",e),!1}},te=(0,n.useCallback)((function(){return u(void 0,void 0,void 0,(function(){var e,t;return h(this,(function(a){switch(a.label){case 0:r(!0),b(null),Q(null),a.label=1;case 1:return a.trys.push([1,6,7,8]),X()?"summary"!==g?[3,3]:(console.log("Fetching summary report with params:",{startDate:v,endDate:w,groupBy:C,departmentId:I?parseInt(I):void 0}),[4,(0,o.DG)(v,w,C,I?parseInt(I):void 0)]):(r(!1),[2]);case 2:if(e=a.sent(),!ee(e,"summary"))throw new Error("Получены некорректные данные от сервера. Проверьте консоль для деталей.");return console.log("Summary report received:",e),0===e.data.length?Q("Отчет успешно сформирован, но данных за выбранный период нет"):Q("Отчет успешно сформирован. Найдено ".concat(e.data.length," ").concat(1===e.data.length?"запись":e.data.length<5?"записи":"записей")),U(e),R(null),[3,5];case 3:return console.log("Fetching daily report with params:",{date:k,departmentId:I?parseInt(I):void 0}),[4,(0,o.ap)(k,void 0,I?parseInt(I):void 0)];case 4:if(e=a.sent(),!ee(e,"daily"))throw new Error("Получены некорректные данные от сервера. Проверьте консоль для деталей.");console.log("Daily report received:",e),0===e.records.length?Q("Отчет успешно сформирован, но данных за выбранную дату нет"):Q("Отчет успешно сформирован. Найдено ".concat(e.records.length," ").concat(1===e.records.length?"запись":e.records.length<5?"записи":"записей")),R(e),U(null),a.label=5;case 5:return[3,8];case 6:return t=a.sent(),console.error("Error generating report:",t),t instanceof Error?b(t.message):b("string"==typeof t?t:"Ошибка при формировании отчета. Проверьте подключение к серверу."),U(null),R(null),[3,8];case 7:return r(!1),[7];case 8:return[2]}}))}))}),[v,w,k,C,I,g,X]),re=function(e){var t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return"".concat(t).concat(r).concat(a,"_").concat(n).concat(o)},ae=function(){if(!v||!w)return 0;var e=new Date(v),t=new Date(w),r=Math.abs(t.getTime()-e.getTime());return Math.ceil(r/864e5)+1},ne=function(e){var t=new Date,r=new Date(t);switch(e){case"week":r.setDate(t.getDate()-7);break;case"month":r.setMonth(t.getMonth()-1);break;case"quarter":r.setMonth(t.getMonth()-3);break;case"year":r.setFullYear(t.getFullYear()-1)}j(W(r)),N(W(t))};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,a.jsx)("h2",{children:"Отчеты"}),(0,a.jsx)("div",{children:(0,a.jsxs)("button",{className:"btn btn-outline-primary me-2",onClick:function(){U(null),R(null),b(null),Q(null)},disabled:!V&&!z,children:[(0,a.jsx)("i",{className:"bi bi-arrow-clockwise me-1"})," Новый отчет"]})})]}),K&&(0,a.jsxs)("div",{className:"alert alert-success alert-dismissible fade show mb-4",children:[(0,a.jsx)("i",{className:"bi bi-check-circle-fill me-2"}),K,(0,a.jsx)("button",{type:"button",className:"btn-close",onClick:function(){return Q(null)}})]}),(0,a.jsxs)("div",{className:"card mb-4 shadow-sm",children:[(0,a.jsx)("div",{className:"card-header bg-primary bg-opacity-10",children:(0,a.jsxs)("h5",{className:"mb-0",children:[(0,a.jsx)("i",{className:"bi bi-sliders me-2"}),"Параметры отчета"]})}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"form-label fw-bold",children:"Тип отчета"}),(0,a.jsxs)("div",{className:"btn-group w-100",role:"group",children:[(0,a.jsx)("input",{type:"radio",className:"btn-check",name:"report-type",id:"summary-report",autoComplete:"off",checked:"summary"===g,onChange:function(){return y("summary")}}),(0,a.jsxs)("label",{className:"btn btn-outline-primary",htmlFor:"summary-report",children:[(0,a.jsx)("i",{className:"bi bi-graph-up me-1"})," Сводный отчет"]}),(0,a.jsx)("input",{type:"radio",className:"btn-check",name:"report-type",id:"daily-report",autoComplete:"off",checked:"daily"===g,onChange:function(){return y("daily")}}),(0,a.jsxs)("label",{className:"btn btn-outline-primary",htmlFor:"daily-report",children:[(0,a.jsx)("i",{className:"bi bi-calendar-day me-1"})," Ежедневный отчет"]})]})]}),"summary"===g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"form-label fw-bold",children:"Период"}),(0,a.jsx)("div",{className:"mb-2",children:(0,a.jsx)("div",{className:"btn-toolbar mb-3",children:(0,a.jsxs)("div",{className:"btn-group me-2",children:[(0,a.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){return ne("week")},children:"Неделя"}),(0,a.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){return ne("month")},children:"Месяц"}),(0,a.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){return ne("quarter")},children:"Квартал"}),(0,a.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:function(){return ne("year")},children:"Год"})]})})}),(0,a.jsxs)("div",{className:"row g-3",children:[(0,a.jsx)("div",{className:"col-md-5",children:(0,a.jsxs)("div",{className:"input-group",children:[(0,a.jsx)("span",{className:"input-group-text",children:(0,a.jsx)("i",{className:"bi bi-calendar-date"})}),(0,a.jsx)("input",{type:"date",className:"form-control",value:v,onChange:function(e){return j(e.target.value)}})]})}),(0,a.jsx)("div",{className:"col-md-2 text-center d-flex align-items-center justify-content-center",children:(0,a.jsx)("i",{className:"bi bi-arrow-right"})}),(0,a.jsx)("div",{className:"col-md-5",children:(0,a.jsxs)("div",{className:"input-group",children:[(0,a.jsx)("span",{className:"input-group-text",children:(0,a.jsx)("i",{className:"bi bi-calendar-date"})}),(0,a.jsx)("input",{type:"date",className:"form-control",value:w,onChange:function(e){return N(e.target.value)},min:v})]})})]}),v&&w&&(0,a.jsxs)("div",{className:"form-text text-muted mt-2",children:[(0,a.jsx)("i",{className:"bi bi-info-circle me-1"}),"Выбран период в ",ae()," ",1===ae()?"день":ae()<5?"дня":"дней"]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"form-label fw-bold",children:"Группировка"}),(0,a.jsxs)("div",{className:"btn-group w-100",children:[(0,a.jsx)("input",{type:"radio",className:"btn-check",name:"groupBy",id:"group-employee",checked:"employee"===C,onChange:function(){return F("employee")}}),(0,a.jsxs)("label",{className:"btn btn-outline-secondary",htmlFor:"group-employee",children:[(0,a.jsx)("i",{className:"bi bi-people me-1"})," По сотрудникам"]}),(0,a.jsx)("input",{type:"radio",className:"btn-check",name:"groupBy",id:"group-department",checked:"department"===C,onChange:function(){return F("department")}}),(0,a.jsxs)("label",{className:"btn btn-outline-secondary",htmlFor:"group-department",children:[(0,a.jsx)("i",{className:"bi bi-building me-1"})," По отделам"]}),(0,a.jsx)("input",{type:"radio",className:"btn-check",name:"groupBy",id:"group-date",checked:"date"===C,onChange:function(){return F("date")}}),(0,a.jsxs)("label",{className:"btn btn-outline-secondary",htmlFor:"group-date",children:[(0,a.jsx)("i",{className:"bi bi-calendar me-1"})," По датам"]})]})]})]}):(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"form-label fw-bold",children:"Дата"}),(0,a.jsxs)("div",{className:"input-group",children:[(0,a.jsx)("span",{className:"input-group-text",children:(0,a.jsx)("i",{className:"bi bi-calendar-date"})}),(0,a.jsx)("input",{type:"date",className:"form-control",value:k,onChange:function(e){return M(e.target.value)}})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"form-label fw-bold",children:"Отдел (необязательно)"}),(0,a.jsxs)("select",{className:"form-select",value:I,onChange:function(e){return A(e.target.value)},children:[(0,a.jsx)("option",{value:"",children:"Все отделы"}),Y.map((function(e){return(0,a.jsx)("option",{value:e.id,children:e.name},e.id)}))]})]}),p&&(0,a.jsxs)("div",{className:"alert alert-danger",children:[(0,a.jsx)("i",{className:"bi bi-exclamation-triangle-fill me-2"}),p]}),(0,a.jsxs)("div",{className:"d-flex flex-wrap gap-2",children:[(0,a.jsx)("button",{className:"btn btn-primary btn-action d-flex align-items-center gap-2",onClick:te,disabled:t,children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),(0,a.jsx)("span",{children:"Формирование..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"bi bi-file-earmark-bar-graph"}),(0,a.jsx)("span",{children:"Сформировать отчет"})]})}),(0,a.jsx)("button",{className:"btn btn-success btn-action d-flex align-items-center gap-2",onClick:function(){return u(void 0,void 0,void 0,(function(){var e,t,r,a;return h(this,(function(n){switch(n.label){case 0:if(!v||!w)return b("Необходимо указать начальную и конечную даты для экспорта"),[2];n.label=1;case 1:return n.trys.push([1,3,4,5]),B(!0),b(null),[4,(0,o.z9)(v,w,"summary"===g?"summary":"detailed",I?parseInt(I):void 0)];case 2:return e=n.sent(),t=new Blob([e.csv_data],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(t),(a=document.createElement("a")).setAttribute("href",r),a.setAttribute("download",e.filename),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),Q("CSV-файл успешно сформирован и скачивается"),[3,5];case 3:return n.sent(),b("Ошибка при экспорте CSV"),[3,5];case 4:return B(!1),[7];case 5:return[2]}}))}))},disabled:q||!v||!w,children:q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),(0,a.jsx)("span",{children:"Экспорт CSV..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"bi bi-file-earmark-excel"}),(0,a.jsx)("span",{children:"Экспорт в CSV"})]})}),(0,a.jsx)("button",{className:"btn btn-info btn-action d-flex align-items-center gap-2",onClick:function(){return u(void 0,void 0,void 0,(function(){var e,t,r,a,n,o,l,u,p;return h(this,(function(h){if(!V&&!z||"summary"===g&&!V||"daily"===g&&!z)return b("Сначала необходимо сформировать отчет"),[2];try{if(J(!0),b(null),e=function(){var e=new c.uE({orientation:"portrait",unit:"mm",format:"a4",putOnlyUsedFonts:!0,compress:!0}),t=e.text.bind(e);return e.text=function(e,r,a,n){if("string"==typeof e)return t(d(e),r,a,n);if(Array.isArray(e)){var o=e.map((function(e){return d(e)}));return t(o,r,a,n)}return this},e}(),t=e.internal.pageSize.getWidth(),e.setFontSize(18),V){switch(e.text("Сводный отчет по рабочему времени",t/2,20,{align:"center"}),e.setFontSize(12),e.text("Период: ".concat((0,s.EU)(V.period.start_date)," - ").concat((0,s.EU)(V.period.end_date)),t/2,30,{align:"center"}),r="",V.group_by){case"employee":r="По сотрудникам";break;case"department":r="По отделам";break;case"date":r="По датам"}e.text("Группировка: ".concat(r),t/2,40,{align:"center"}),n=[],"employee"===V.group_by?n.push(["Sotrudnik","Otdel","Vsego chasov","Zapisej"]):"department"===V.group_by?n.push(["Otdel","Vsego chasov","Zapisej"]):n.push(["Data","Sotrudnik","Vsego chasov","Zapisej"]),o=V.data.map((function(e){return"employee"===V.group_by?[d(e.employee_name||""),d(e.department_name||"Ne ukazan"),m(e.total_hours),e.record_count.toString()]:"department"===V.group_by?[d(e.department_name||"Ne ukazan"),m(e.total_hours),e.record_count.toString()]:[(0,s.EU)(e.date||""),d(e.employee_name||""),m(e.total_hours),e.record_count.toString()]})),l=m(V.data.reduce((function(e,t){var r="number"==typeof t.total_hours?t.total_hours:parseFloat(String(t.total_hours))||0;return e+(Math.abs(r)>1e4?Math.abs(r)/1e7:Math.abs(r))}),0)),a=V.data.reduce((function(e,t){return e+t.record_count}),0),"employee"===V.group_by||"date"===V.group_by?o.push(["ITOGO","",l,a.toString()]):o.push(["ITOGO",l,a.toString()]),(0,i.Ay)(e,{head:n,body:o,startY:50,theme:"grid",headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},footStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"}})}else z&&(e.text("Ежедневный отчет по рабочему времени",t/2,20,{align:"center"}),e.setFontSize(12),e.text("Дата: ".concat((0,s.EU)(z.date)),t/2,30,{align:"center"}),n=[["Sotrudnik","Nachalo","Okonchanie","Chasov","Opisanie"]],o=z.records.map((function(e){return[d(e.employee_name||""),(0,s.V9)(e.check_in),e.check_out?(0,s.V9)(e.check_out):d("В процессе"),m(e.duration_hours),d(e.description||"")]})),l=m(z.records.reduce((function(e,t){var r="number"==typeof t.duration_hours?t.duration_hours:parseFloat(String(t.duration_hours))||0;return e+(Math.abs(r)>1e4?Math.abs(r)/1e7:Math.abs(r))}),0)),o.push(["ITOGO ZA DEN","","",l,""]),(0,i.Ay)(e,{head:n,body:o,startY:50,theme:"grid",headStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"},footStyles:{fillColor:[41,128,185],textColor:255,fontStyle:"bold"}}));u=new Date,e.setFontSize(10),e.text("Дата формирования: ".concat((0,s.V9)(u.toISOString())),14,e.internal.pageSize.getHeight()-10),p=V?"time_report_summary_".concat(re(new Date),".pdf"):"time_report_daily_".concat(re(new Date),".pdf"),e.save(p),Q("PDF-отчет успешно сформирован и скачивается")}catch(e){console.error("PDF export error:",e),b("Ошибка при создании PDF-отчета")}finally{J(!1)}return[2]}))}))},disabled:H||!V&&!z,children:H?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}),(0,a.jsx)("span",{children:"Создание PDF..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"bi bi-file-earmark-pdf"}),(0,a.jsx)("span",{children:"Экспорт в PDF"})]})})]})]})]}),V&&(0,a.jsxs)("div",{className:"card shadow-sm",children:[(0,a.jsxs)("div",{className:"card-header bg-success bg-opacity-10 d-flex justify-content-between align-items-center",children:[(0,a.jsxs)("h5",{className:"mb-0",children:[(0,a.jsx)("i",{className:"bi bi-graph-up me-2"}),"Сводный отчет: ",(0,s.EU)(V.period.start_date)," - ",(0,s.EU)(V.period.end_date)]}),(0,a.jsxs)("span",{className:"badge bg-success",children:[V.data.length," ",1===V.data.length?"запись":V.data.length<5?"записи":"записей"]})]}),(0,a.jsx)("div",{className:"card-body",children:(0,a.jsx)("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table table-striped table-hover",children:[(0,a.jsx)("thead",{className:"table-light",children:(0,a.jsxs)("tr",{children:["employee"===V.group_by&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("th",{children:"Сотрудник"}),(0,a.jsx)("th",{children:"Отдел"})]}),"department"===V.group_by&&(0,a.jsx)("th",{children:"Отдел"}),"date"===V.group_by&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("th",{children:"Дата"}),(0,a.jsx)("th",{children:"Сотрудник"})]}),(0,a.jsx)("th",{className:"text-end",children:"Всего часов"}),(0,a.jsx)("th",{className:"text-end",children:"Записей"})]})}),(0,a.jsxs)("tbody",{children:[V.data.map((function(e,t){return(0,a.jsxs)("tr",{children:["employee"===V.group_by&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"fw-medium",children:e.employee_name}),(0,a.jsx)("td",{children:e.department_name||"Не указан"})]}),"department"===V.group_by&&(0,a.jsx)("td",{className:"fw-medium",children:e.department_name||"Не указан"}),"date"===V.group_by&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("td",{className:"fw-medium",children:(0,s.EU)(e.date)}),(0,a.jsx)("td",{children:e.employee_name})]}),(0,a.jsx)("td",{className:"text-end fw-bold",children:m(e.total_hours)}),(0,a.jsx)("td",{className:"text-end",children:e.record_count})]},t)})),(0,a.jsxs)("tr",{className:"table-primary",children:["employee"===V.group_by&&(0,a.jsx)("td",{colSpan:2,className:"fw-bold",children:"ИТОГО"}),"department"===V.group_by&&(0,a.jsx)("td",{className:"fw-bold",children:"ИТОГО"}),"date"===V.group_by&&(0,a.jsx)("td",{colSpan:2,className:"fw-bold",children:"ИТОГО"}),(0,a.jsx)("td",{className:"text-end fw-bold",children:m(V.data.reduce((function(e,t){var r="number"==typeof t.total_hours?t.total_hours:parseFloat(String(t.total_hours))||0;return e+(Math.abs(r)>1e4?Math.abs(r)/1e7:Math.abs(r))}),0))}),(0,a.jsx)("td",{className:"text-end fw-bold",children:V.data.reduce((function(e,t){return e+t.record_count}),0)})]})]})]})})})]}),z&&(0,a.jsxs)("div",{className:"card shadow-sm",children:[(0,a.jsxs)("div",{className:"card-header bg-info bg-opacity-10 d-flex justify-content-between align-items-center",children:[(0,a.jsxs)("h5",{className:"mb-0",children:[(0,a.jsx)("i",{className:"bi bi-calendar-day me-2"}),"Ежедневный отчет: ",(0,s.EU)(z.date)]}),(0,a.jsxs)("span",{className:"badge bg-info",children:[z.records.length," ",1===z.records.length?"запись":z.records.length<5?"записи":"записей"]})]}),(0,a.jsx)("div",{className:"card-body",children:0===z.records.length?(0,a.jsxs)("div",{className:"alert alert-warning",children:[(0,a.jsx)("i",{className:"bi bi-exclamation-circle me-2"}),"Нет записей за выбранную дату"]}):(0,a.jsx)("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table table-striped table-hover",children:[(0,a.jsx)("thead",{className:"table-light",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Сотрудник"}),(0,a.jsx)("th",{children:"Начало"}),(0,a.jsx)("th",{children:"Окончание"}),(0,a.jsx)("th",{className:"text-end",children:"Часов"}),(0,a.jsx)("th",{children:"Описание"})]})}),(0,a.jsxs)("tbody",{children:[z.records.map((function(e){return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"fw-medium",children:e.employee_name}),(0,a.jsx)("td",{children:(0,s.V9)(e.check_in)}),(0,a.jsx)("td",{children:e.check_out?(0,s.V9)(e.check_out):(0,a.jsx)("span",{className:"badge bg-warning text-dark",children:"В процессе"})}),(0,a.jsx)("td",{className:"text-end fw-bold",children:m(e.duration_hours)}),(0,a.jsx)("td",{children:e.description||(0,a.jsx)("span",{className:"text-muted",children:"—"})})]},e.id)})),(0,a.jsxs)("tr",{className:"table-primary",children:[(0,a.jsx)("td",{colSpan:3,className:"fw-bold",children:"ИТОГО ЗА ДЕНЬ"}),(0,a.jsx)("td",{className:"text-end fw-bold",children:m(z.records.reduce((function(e,t){var r="number"==typeof t.duration_hours?t.duration_hours:parseFloat(String(t.duration_hours))||0;return e+(Math.abs(r)>1e4?Math.abs(r)/1e7:Math.abs(r))}),0))}),(0,a.jsx)("td",{})]})]})]})})})]})]})}}}]);