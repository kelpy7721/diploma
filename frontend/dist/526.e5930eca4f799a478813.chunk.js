"use strict";(self.webpackChunktime_tracking_system_frontend=self.webpackChunktime_tracking_system_frontend||[]).push([[526],{526:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});var n=r(4848),a=r(6540),o=r(4976),s=r(3661);const i=function(){var e=(0,a.useState)(!0),t=e[0],r=e[1],i=(0,a.useState)([]),c=i[0],l=i[1],u=(0,a.useState)({total:0,pages:0,page:1}),d=u[0],p=u[1],h=(0,a.useState)(null),f=h[0],v=h[1];return(0,a.useEffect)((function(){var e,t,n,a;e=void 0,t=void 0,a=function(){var e;return function(e,t){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(0,s.Oc)(1,10)];case 1:return e=t.sent(),l(e.items),p({total:e.total,pages:e.pages,page:e.page}),r(!1),[3,3];case 2:return t.sent(),v("Ошибка при загрузке данных"),r(!1),[3,3];case 3:return[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function s(e){try{c(a.next(e))}catch(e){o(e)}}function i(e){try{c(a.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((a=a.apply(e,t||[])).next())}))}),[]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,n.jsx)("h2",{children:"Управление сотрудниками"}),(0,n.jsx)(o.N_,{to:"/employees/new",className:"btn btn-success",children:"Добавить сотрудника"})]}),t?(0,n.jsx)("p",{children:"Загрузка..."}):f?(0,n.jsx)("div",{className:"alert alert-danger",children:f}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"card",children:(0,n.jsx)("div",{className:"card-body",children:(0,n.jsx)("div",{className:"table-responsive",children:(0,n.jsxs)("table",{className:"table table-striped",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"ID"}),(0,n.jsx)("th",{children:"Имя"}),(0,n.jsx)("th",{children:"Фамилия"}),(0,n.jsx)("th",{children:"Email"}),(0,n.jsx)("th",{children:"Должность"}),(0,n.jsx)("th",{children:"Отдел"}),(0,n.jsx)("th",{children:"Статус"}),(0,n.jsx)("th",{children:"Действия"})]})}),(0,n.jsx)("tbody",{children:c.map((function(e){return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.id}),(0,n.jsx)("td",{children:e.first_name}),(0,n.jsx)("td",{children:e.last_name}),(0,n.jsx)("td",{children:e.email}),(0,n.jsx)("td",{children:e.position}),(0,n.jsx)("td",{children:e.department_name||"Не указан"}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"badge ".concat(e.is_active?"bg-success":"bg-danger"),children:e.is_active?"Активен":"Неактивен"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"btn-group btn-group-sm",children:[(0,n.jsx)(o.N_,{to:"/employees/".concat(e.id),className:"btn btn-info",children:"Просмотр"}),(0,n.jsx)(o.N_,{to:"/employees/".concat(e.id,"/edit"),className:"btn btn-primary",children:"Изменить"})]})})]},e.id)}))})]})})})}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsxs)("p",{children:["Всего записей: ",d.total,", Страница: ",d.page," из"," ",d.pages]})})]})]})}},3661:(e,t,r)=>{r.d(t,{DG:()=>b,Oc:()=>u,Y$:()=>f,aJ:()=>d,ap:()=>g,ax:()=>l,b$:()=>y,bV:()=>h,is:()=>m,l3:()=>p,w$:()=>v,z9:()=>w});var n=r(1083),a=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function i(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}c((n=n.apply(e,t||[])).next())}))},o=function(e,t){var r,n,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=i(0),s.throw=i(1),s.return=i(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},s=function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},i=n.A.create({baseURL:"/api",timeout:3e4}),c=function(e,t){if(console.error("API Error:",e),n.A.isAxiosError(e)){var r=e;if(r.response){var a=r.response.data,o=a&&"object"==typeof a?a.error||a.message||JSON.stringify(a):"Ошибка сервера";throw new Error("".concat(t||"Ошибка API",": ").concat(o))}throw r.request?new Error("Сервер не отвечает. Проверьте соединение с интернетом"):new Error("Ошибка при выполнении запроса: ".concat(r.message))}throw new Error(t||"Неизвестная ошибка при запросе к API")},l=function(){return a(void 0,void 0,void 0,(function(){var e,t,r;return o(this,(function(n){switch(n.label){case 0:return console.log("Запрос отделов начат"),[4,i.get("/departments")];case 1:return e=n.sent(),console.log("Получен ответ по отделам:",e.data),t=e.data.items,console.log("Отделы (массив):",t),r=t.filter((function(e,t,r){return t===r.findIndex((function(t){return t.id===e.id}))})),console.log("Уникальные отделы после фильтрации:",r),[2,r]}}))}))},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,s([],e,!0),void 0,(function(e,t,r,n,a){var s;return void 0===e&&(e=1),void 0===t&&(t=20),o(this,(function(o){switch(o.label){case 0:return s={page:e,per_page:t},r&&(s.department_id=r),void 0!==n&&(s.is_active=n),a&&(s.search=a),[4,i.get("/employees",{params:s})];case 1:return[2,o.sent().data]}}))}))},d=function(){return a(void 0,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,i.get("/employees/with-open-records")];case 1:return[2,e.sent().data.items||[]]}}))}))},p=function(e){return a(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,i.get("/employees/".concat(e))];case 1:return[2,t.sent().data]}}))}))},h=function(e){return a(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,i.post("/employees",e)];case 1:return[2,t.sent().data]}}))}))},f=function(e,t){return a(void 0,void 0,void 0,(function(){var r,n;return o(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),console.log("Updating employee with data:",t),[4,i.put("/employees/".concat(e),t)];case 1:return r=a.sent(),console.log("Employee update response:",r.data),[2,r.data];case 2:throw n=a.sent(),console.error("Error updating employee:",n),n;case 3:return[2]}}))}))},v=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,s([],e,!0),void 0,(function(e,t,r,n,a){var s;return void 0===e&&(e=1),void 0===t&&(t=20),o(this,(function(o){switch(o.label){case 0:return s={page:e,per_page:t},r&&(s.employee_id=r),n&&(s.start_date=n),a&&(s.end_date=a),[4,i.get("/time-records",{params:s})];case 1:return[2,o.sent().data]}}))}))},m=function(e,t){return a(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,i.post("/time-records/check-in",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},y=function(e,t){return a(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,i.post("/time-records/check-out",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},b=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return a(void 0,s([e,t],r,!0),void 0,(function(e,t,r,n){var a,s,l;return void 0===r&&(r="employee"),o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),a={start_date:e,end_date:t,group_by:r},n&&(a.department_id=n),console.log("Request params for summary report:",a),[4,i.get("/reports/summary",{params:a})];case 1:if(s=o.sent(),console.log("Summary report API response:",s.data),!s.data||!s.data.period||!s.data.data)throw new Error("Неверный формат ответа от сервера");return[2,s.data];case 2:throw l=o.sent(),c(l,"Ошибка при получении сводного отчета"),l;case 3:return[2]}}))}))},g=function(e,t,r){return a(void 0,void 0,void 0,(function(){var n,a,s;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n={date:e},t&&(n.employee_id=t),r&&(n.department_id=r),console.log("Request params for daily report:",n),[4,i.get("/reports/daily",{params:n})];case 1:if(a=o.sent(),console.log("Daily report API response:",a.data),!a.data||!a.data.date||!a.data.records)throw new Error("Неверный формат ответа от сервера");return[2,a.data];case 2:throw s=o.sent(),c(s,"Ошибка при получении ежедневного отчета"),s;case 3:return[2]}}))}))},w=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return a(void 0,s([e,t],r,!0),void 0,(function(e,t,r,n){var a,s,l;return void 0===r&&(r="summary"),o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),a={start_date:e,end_date:t,type:r},n&&(a.department_id=n),console.log("Request params for CSV export:",a),[4,i.get("/reports/export/csv",{params:a})];case 1:if(s=o.sent(),console.log("CSV export response received"),!s.data||!s.data.csv_data||!s.data.filename)throw new Error("Неверный формат ответа от сервера при экспорте CSV");return[2,s.data];case 2:throw l=o.sent(),c(l,"Ошибка при экспорте CSV"),l;case 3:return[2]}}))}))}}}]);