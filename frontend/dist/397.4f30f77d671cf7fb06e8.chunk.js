"use strict";(self.webpackChunktime_tracking_system_frontend=self.webpackChunktime_tracking_system_frontend||[]).push([[397],{3661:(e,t,r)=>{r.d(t,{DG:()=>v,Oc:()=>d,Y$:()=>p,aJ:()=>u,ap:()=>y,ax:()=>l,b$:()=>x,bV:()=>h,is:()=>b,l3:()=>m,w$:()=>f,z9:()=>g});var n=r(1083),s=function(e,t,r,n){return new(r||(r=Promise))((function(s,a){function i(e){try{o(n.next(e))}catch(e){a(e)}}function c(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}o((n=n.apply(e,t||[])).next())}))},a=function(e,t){var r,n,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(o){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(s=2&c[0]?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[2&c[0],s.value]),c[0]){case 0:case 1:s=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3])){a.label=c[1];break}if(6===c[0]&&a.label<s[1]){a.label=s[1],s=c;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(c);break}s[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,o])}}},i=function(e,t,r){if(r||2===arguments.length)for(var n,s=0,a=t.length;s<a;s++)!n&&s in t||(n||(n=Array.prototype.slice.call(t,0,s)),n[s]=t[s]);return e.concat(n||Array.prototype.slice.call(t))},c=n.A.create({baseURL:"/api",timeout:3e4}),o=function(e,t){if(console.error("API Error:",e),n.A.isAxiosError(e)){var r=e;if(r.response){var s=r.response.data,a=s&&"object"==typeof s?s.error||s.message||JSON.stringify(s):"Ошибка сервера";throw new Error("".concat(t||"Ошибка API",": ").concat(a))}throw r.request?new Error("Сервер не отвечает. Проверьте соединение с интернетом"):new Error("Ошибка при выполнении запроса: ".concat(r.message))}throw new Error(t||"Неизвестная ошибка при запросе к API")},l=function(){return s(void 0,void 0,void 0,(function(){var e,t,r;return a(this,(function(n){switch(n.label){case 0:return console.log("Запрос отделов начат"),[4,c.get("/departments")];case 1:return e=n.sent(),console.log("Получен ответ по отделам:",e.data),t=e.data.items,console.log("Отделы (массив):",t),r=t.filter((function(e,t,r){return t===r.findIndex((function(t){return t.id===e.id}))})),console.log("Уникальные отделы после фильтрации:",r),[2,r]}}))}))},d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(void 0,i([],e,!0),void 0,(function(e,t,r,n,s){var i;return void 0===e&&(e=1),void 0===t&&(t=20),a(this,(function(a){switch(a.label){case 0:return i={page:e,per_page:t},r&&(i.department_id=r),void 0!==n&&(i.is_active=n),s&&(i.search=s),[4,c.get("/employees",{params:i})];case 1:return[2,a.sent().data]}}))}))},u=function(){return s(void 0,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,c.get("/employees/with-open-records")];case 1:return[2,e.sent().data.items||[]]}}))}))},m=function(e){return s(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,c.get("/employees/".concat(e))];case 1:return[2,t.sent().data]}}))}))},h=function(e){return s(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,c.post("/employees",e)];case 1:return[2,t.sent().data]}}))}))},p=function(e,t){return s(void 0,void 0,void 0,(function(){var r,n;return a(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),console.log("Updating employee with data:",t),[4,c.put("/employees/".concat(e),t)];case 1:return r=s.sent(),console.log("Employee update response:",r.data),[2,r.data];case 2:throw n=s.sent(),console.error("Error updating employee:",n),n;case 3:return[2]}}))}))},f=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(void 0,i([],e,!0),void 0,(function(e,t,r,n,s){var i;return void 0===e&&(e=1),void 0===t&&(t=20),a(this,(function(a){switch(a.label){case 0:return i={page:e,per_page:t},r&&(i.employee_id=r),n&&(i.start_date=n),s&&(i.end_date=s),[4,c.get("/time-records",{params:i})];case 1:return[2,a.sent().data]}}))}))},b=function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,c.post("/time-records/check-in",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},x=function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,c.post("/time-records/check-out",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},v=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return s(void 0,i([e,t],r,!0),void 0,(function(e,t,r,n){var s,i,l;return void 0===r&&(r="employee"),a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),s={start_date:e,end_date:t,group_by:r},n&&(s.department_id=n),console.log("Request params for summary report:",s),[4,c.get("/reports/summary",{params:s})];case 1:if(i=a.sent(),console.log("Summary report API response:",i.data),!i.data||!i.data.period||!i.data.data)throw new Error("Неверный формат ответа от сервера");return[2,i.data];case 2:throw l=a.sent(),o(l,"Ошибка при получении сводного отчета"),l;case 3:return[2]}}))}))},y=function(e,t,r){return s(void 0,void 0,void 0,(function(){var n,s,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n={date:e},t&&(n.employee_id=t),r&&(n.department_id=r),console.log("Request params for daily report:",n),[4,c.get("/reports/daily",{params:n})];case 1:if(s=a.sent(),console.log("Daily report API response:",s.data),!s.data||!s.data.date||!s.data.records)throw new Error("Неверный формат ответа от сервера");return[2,s.data];case 2:throw i=a.sent(),o(i,"Ошибка при получении ежедневного отчета"),i;case 3:return[2]}}))}))},g=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return s(void 0,i([e,t],r,!0),void 0,(function(e,t,r,n){var s,i,l;return void 0===r&&(r="summary"),a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),s={start_date:e,end_date:t,type:r},n&&(s.department_id=n),console.log("Request params for CSV export:",s),[4,c.get("/reports/export/csv",{params:s})];case 1:if(i=a.sent(),console.log("CSV export response received"),!i.data||!i.data.csv_data||!i.data.filename)throw new Error("Неверный формат ответа от сервера при экспорте CSV");return[2,i.data];case 2:throw l=a.sent(),o(l,"Ошибка при экспорте CSV"),l;case 3:return[2]}}))}))}},5739:(e,t,r)=>{r.d(t,{EU:()=>s,Nl:()=>n,Qn:()=>a,V9:()=>i});var n=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Europe/Moscow"}).format(t)},s=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"Europe/Moscow"}).format(t)},a=function(){return(new Date).toLocaleDateString("ru-RU",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"Europe/Moscow"})},i=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Europe/Moscow"}).format(t)}},8397:(e,t,r)=>{r.r(t),r.d(t,{default:()=>o});var n=r(4848),s=r(6540),a=r(4976),i=r(3661),c=r(5739);const o=function(){var e=(0,s.useState)(!0),t=e[0],r=e[1],o=(0,s.useState)([]),l=o[0],d=o[1],u=(0,s.useState)(null),m=u[0],h=u[1],p=(0,s.useState)({totalHoursToday:0,activeEmployees:0,pendingCheckins:0}),f=p[0],b=p[1];return(0,s.useEffect)((function(){var e,t,n,s;e=void 0,t=void 0,s=function(){var e,t,n,s;return function(e,t){var r,n,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(o){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(s=2&c[0]?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[2&c[0],s.value]),c[0]){case 0:case 1:s=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3])){a.label=c[1];break}if(6===c[0]&&a.label<s[1]){a.label=s[1],s=c;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(c);break}s[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,o])}}}(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(0,i.w$)(1,5)];case 1:return e=a.sent(),d(e.items),t=(new Date).toISOString().split("T")[0],n=0,s=0,e.items.forEach((function(e){e.check_in.startsWith(t)&&(n+=e.duration_hours,e.check_out||s++)})),b({totalHoursToday:n,activeEmployees:s,pendingCheckins:Math.floor(5*Math.random())}),r(!1),[3,3];case 2:return a.sent(),h("Ошибка при загрузке данных"),r(!1),[3,3];case 3:return[2]}}))},new((n=void 0)||(n=Promise))((function(r,a){function i(e){try{o(s.next(e))}catch(e){a(e)}}function c(e){try{o(s.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}o((s=s.apply(e,t||[])).next())}))}),[]),(0,n.jsxs)("div",{className:"dashboard",children:[(0,n.jsx)("div",{className:"welcome-section mb-4",children:(0,n.jsx)("div",{className:"row align-items-center",children:(0,n.jsxs)("div",{className:"col",children:[(0,n.jsx)("h2",{children:"Панель управления"}),(0,n.jsxs)("p",{className:"text-muted",children:[(0,n.jsx)("i",{className:"bi bi-calendar-event me-2"}),(0,c.Qn)()]})]})})}),(0,n.jsxs)("div",{className:"row mb-4",children:[(0,n.jsx)("div",{className:"col-md-4 mb-3 mb-md-0",children:(0,n.jsx)("div",{className:"card dashboard-card h-100 border-start border-primary border-4",children:(0,n.jsx)("div",{className:"card-body",children:(0,n.jsxs)("div",{className:"d-flex align-items-center",children:[(0,n.jsx)("div",{className:"bg-light-primary rounded-circle p-3 me-3",children:(0,n.jsx)("i",{className:"bi bi-clock text-primary",style:{fontSize:"1.5rem"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"text-muted mb-1",children:"Часов сегодня"}),(0,n.jsx)("h3",{className:"mb-0",children:f.totalHoursToday.toFixed(1)})]})]})})})}),(0,n.jsx)("div",{className:"col-md-4 mb-3 mb-md-0",children:(0,n.jsx)("div",{className:"card dashboard-card h-100 border-start border-success border-4",children:(0,n.jsx)("div",{className:"card-body",children:(0,n.jsxs)("div",{className:"d-flex align-items-center",children:[(0,n.jsx)("div",{className:"bg-light-success rounded-circle p-3 me-3",children:(0,n.jsx)("i",{className:"bi bi-people text-success",style:{fontSize:"1.5rem"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"text-muted mb-1",children:"Сотрудников на рабочем месте"}),(0,n.jsx)("h3",{className:"mb-0",children:f.activeEmployees})]})]})})})}),(0,n.jsx)("div",{className:"col-md-4",children:(0,n.jsx)("div",{className:"card dashboard-card h-100 border-start border-warning border-4",children:(0,n.jsx)("div",{className:"card-body",children:(0,n.jsxs)("div",{className:"d-flex align-items-center",children:[(0,n.jsx)("div",{className:"bg-light-warning rounded-circle p-3 me-3",children:(0,n.jsx)("i",{className:"bi bi-exclamation-triangle text-warning",style:{fontSize:"1.5rem"}})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"text-muted mb-1",children:"Ожидают регистрации"}),(0,n.jsx)("h3",{className:"mb-0",children:f.pendingCheckins})]})]})})})})]}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsx)("div",{className:"col-md-8 mb-4",children:(0,n.jsxs)("div",{className:"card h-100 dashboard-card shadow-sm",children:[(0,n.jsxs)("div",{className:"card-header bg-white d-flex justify-content-between align-items-center",children:[(0,n.jsxs)("h5",{className:"card-title mb-0",children:[(0,n.jsx)("i",{className:"bi bi-clock-history me-2 text-primary"}),"Последние записи"]}),(0,n.jsx)(a.N_,{to:"/time-records",className:"btn btn-sm btn-outline-primary",children:"Все записи"})]}),(0,n.jsx)("div",{className:"card-body",children:t?(0,n.jsx)("div",{className:"d-flex justify-content-center align-items-center h-100",children:(0,n.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,n.jsx)("span",{className:"visually-hidden",children:"Загрузка..."})})}):m?(0,n.jsxs)("div",{className:"alert alert-danger",children:[(0,n.jsx)("i",{className:"bi bi-exclamation-triangle-fill me-2"}),m]}):l.length>0?(0,n.jsx)("div",{className:"table-responsive",children:(0,n.jsxs)("table",{className:"table table-hover",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsxs)("th",{children:[(0,n.jsx)("i",{className:"bi bi-person me-1"}),"Сотрудник"]}),(0,n.jsxs)("th",{children:[(0,n.jsx)("i",{className:"bi bi-box-arrow-in-right me-1"}),"Начало"]}),(0,n.jsxs)("th",{children:[(0,n.jsx)("i",{className:"bi bi-box-arrow-left me-1"}),"Конец"]}),(0,n.jsxs)("th",{children:[(0,n.jsx)("i",{className:"bi bi-hourglass-split me-1"}),"Часов"]})]})}),(0,n.jsx)("tbody",{children:l.map((function(e){return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"d-flex align-items-center",children:[(0,n.jsx)("div",{className:"avatar rounded-circle bg-light text-primary me-2 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px"},children:e.employee_name.charAt(0).toUpperCase()}),e.employee_name]})}),(0,n.jsx)("td",{children:(0,c.Nl)(e.check_in)}),(0,n.jsx)("td",{children:e.check_out?(0,c.Nl)(e.check_out):(0,n.jsx)("span",{className:"badge bg-success",children:"В процессе"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("span",{className:"hours-badge",children:[e.duration_hours.toFixed(1)," ч"]})})]},e.id)}))})]})}):(0,n.jsxs)("div",{className:"text-center py-5",children:[(0,n.jsx)("i",{className:"bi bi-calendar-x text-muted",style:{fontSize:"3rem"}}),(0,n.jsx)("p",{className:"mt-3 text-muted",children:"Нет записей"})]})})]})}),(0,n.jsx)("div",{className:"col-md-4 mb-4",children:(0,n.jsxs)("div",{className:"card h-100 dashboard-card shadow-sm",children:[(0,n.jsx)("div",{className:"card-header bg-white",children:(0,n.jsxs)("h5",{className:"card-title mb-0",children:[(0,n.jsx)("i",{className:"bi bi-lightning-charge me-2 text-primary"}),"Быстрые действия"]})}),(0,n.jsx)("div",{className:"card-body",children:(0,n.jsxs)("div",{className:"d-grid gap-3",children:[(0,n.jsxs)(a.N_,{to:"/time-records/check-in",className:"btn btn-action",children:[(0,n.jsx)("i",{className:"bi bi-box-arrow-in-right me-2"}),"Отметить приход"]}),(0,n.jsxs)(a.N_,{to:"/time-records/check-out",className:"btn btn-action",children:[(0,n.jsx)("i",{className:"bi bi-box-arrow-left me-2"}),"Отметить уход"]}),(0,n.jsxs)(a.N_,{to:"/reports",className:"btn btn-action",children:[(0,n.jsx)("i",{className:"bi bi-graph-up me-2"}),"Сформировать отчет"]}),(0,n.jsxs)(a.N_,{to:"/employees",className:"btn btn-action",children:[(0,n.jsx)("i",{className:"bi bi-people me-2"}),"Управление сотрудниками"]})]})})]})})]})]})}}}]);