"use strict";(self.webpackChunktime_tracking_system_frontend=self.webpackChunktime_tracking_system_frontend||[]).push([[933],{3661:(e,t,n)=>{n.d(t,{DG:()=>y,Oc:()=>u,Y$:()=>p,aJ:()=>d,ap:()=>g,ax:()=>c,b$:()=>b,bV:()=>f,is:()=>v,l3:()=>m,w$:()=>h,z9:()=>x});var r=n(1083),a=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))},i=function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},s=function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},o=r.A.create({baseURL:"/api",timeout:3e4}),l=function(e,t){if(console.error("API Error:",e),r.A.isAxiosError(e)){var n=e;if(n.response){var a=n.response.data,i=a&&"object"==typeof a?a.error||a.message||JSON.stringify(a):"Ошибка сервера";throw new Error("".concat(t||"Ошибка API",": ").concat(i))}throw n.request?new Error("Сервер не отвечает. Проверьте соединение с интернетом"):new Error("Ошибка при выполнении запроса: ".concat(n.message))}throw new Error(t||"Неизвестная ошибка при запросе к API")},c=function(){return a(void 0,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:return console.log("Запрос отделов начат"),[4,o.get("/departments")];case 1:return e=r.sent(),console.log("Получен ответ по отделам:",e.data),t=e.data.items,console.log("Отделы (массив):",t),n=t.filter((function(e,t,n){return t===n.findIndex((function(t){return t.id===e.id}))})),console.log("Уникальные отделы после фильтрации:",n),[2,n]}}))}))},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,s([],e,!0),void 0,(function(e,t,n,r,a){var s;return void 0===e&&(e=1),void 0===t&&(t=20),i(this,(function(i){switch(i.label){case 0:return s={page:e,per_page:t},n&&(s.department_id=n),void 0!==r&&(s.is_active=r),a&&(s.search=a),[4,o.get("/employees",{params:s})];case 1:return[2,i.sent().data]}}))}))},d=function(){return a(void 0,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,o.get("/employees/with-open-records")];case 1:return[2,e.sent().data.items||[]]}}))}))},m=function(e){return a(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,o.get("/employees/".concat(e))];case 1:return[2,t.sent().data]}}))}))},f=function(e){return a(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,o.post("/employees",e)];case 1:return[2,t.sent().data]}}))}))},p=function(e,t){return a(void 0,void 0,void 0,(function(){var n,r;return i(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),console.log("Updating employee with data:",t),[4,o.put("/employees/".concat(e),t)];case 1:return n=a.sent(),console.log("Employee update response:",n.data),[2,n.data];case 2:throw r=a.sent(),console.error("Error updating employee:",r),r;case 3:return[2]}}))}))},h=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,s([],e,!0),void 0,(function(e,t,n,r,a){var s;return void 0===e&&(e=1),void 0===t&&(t=20),i(this,(function(i){switch(i.label){case 0:return s={page:e,per_page:t},n&&(s.employee_id=n),r&&(s.start_date=r),a&&(s.end_date=a),[4,o.get("/time-records",{params:s})];case 1:return[2,i.sent().data]}}))}))},v=function(e,t){return a(void 0,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,o.post("/time-records/check-in",{employee_id:e,description:t})];case 1:return[2,n.sent().data]}}))}))},b=function(e,t){return a(void 0,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,o.post("/time-records/check-out",{employee_id:e,description:t})];case 1:return[2,n.sent().data]}}))}))},y=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return a(void 0,s([e,t],n,!0),void 0,(function(e,t,n,r){var a,s,c;return void 0===n&&(n="employee"),i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),a={start_date:e,end_date:t,group_by:n},r&&(a.department_id=r),console.log("Request params for summary report:",a),[4,o.get("/reports/summary",{params:a})];case 1:if(s=i.sent(),console.log("Summary report API response:",s.data),!s.data||!s.data.period||!s.data.data)throw new Error("Неверный формат ответа от сервера");return[2,s.data];case 2:throw c=i.sent(),l(c,"Ошибка при получении сводного отчета"),c;case 3:return[2]}}))}))},g=function(e,t,n){return a(void 0,void 0,void 0,(function(){var r,a,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r={date:e},t&&(r.employee_id=t),n&&(r.department_id=n),console.log("Request params for daily report:",r),[4,o.get("/reports/daily",{params:r})];case 1:if(a=i.sent(),console.log("Daily report API response:",a.data),!a.data||!a.data.date||!a.data.records)throw new Error("Неверный формат ответа от сервера");return[2,a.data];case 2:throw s=i.sent(),l(s,"Ошибка при получении ежедневного отчета"),s;case 3:return[2]}}))}))},x=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return a(void 0,s([e,t],n,!0),void 0,(function(e,t,n,r){var a,s,c;return void 0===n&&(n="summary"),i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),a={start_date:e,end_date:t,type:n},r&&(a.department_id=r),console.log("Request params for CSV export:",a),[4,o.get("/reports/export/csv",{params:a})];case 1:if(s=i.sent(),console.log("CSV export response received"),!s.data||!s.data.csv_data||!s.data.filename)throw new Error("Неверный формат ответа от сервера при экспорте CSV");return[2,s.data];case 2:throw c=i.sent(),l(c,"Ошибка при экспорте CSV"),c;case 3:return[2]}}))}))}},8933:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var r=n(4848),a=n(6540),i=n(7767),s=n(4976),o=n(3661),l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},l.apply(this,arguments)},c=function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function s(e){try{l(r.next(e))}catch(e){i(e)}}function o(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((r=r.apply(e,t||[])).next())}))},u=function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};const d=function(){var e=(0,i.g)().id,t=(0,i.Zp)(),n=(0,a.useState)(!0),d=n[0],m=n[1],f=(0,a.useState)(!1),p=f[0],h=f[1],v=(0,a.useState)(null),b=v[0],y=v[1],g=(0,a.useState)(null),x=g[0],_=g[1],w=(0,a.useState)({}),j=w[0],N=w[1],k=(0,a.useState)({first_name:"",last_name:"",email:"",position:"",department_id:null,is_active:!0}),S=k[0],E=k[1],I=(0,a.useState)([]),C=I[0],O=I[1],A=(0,a.useState)({first_name:null,last_name:null,email:null,position:null}),F=A[0],q=A[1],D="new"===e||void 0===e;(0,a.useEffect)((function(){m(!0),c(void 0,void 0,void 0,(function(){var t,n,r,a,i;return u(this,(function(s){switch(s.label){case 0:s.trys.push([0,6,,7]),E({first_name:"",last_name:"",email:"",position:"",department_id:null,is_active:!0}),N({}),O([]),s.label=1;case 1:return s.trys.push([1,4,,5]),console.log("Fetching departments..."),[4,(0,o.ax)()];case 2:return t=s.sent(),console.log("Departments data:",t),O(t),D?(m(!1),[2]):(n=Number(e),isNaN(n)?(y("Некорректный ID сотрудника"),m(!1),[2]):(console.log("Fetching employee data..."),console.log("Employee ID for fetch:",n),[4,(0,o.l3)(n)]));case 3:return r=s.sent(),console.log("Employee data:",r),E(r),N(r),m(!1),[3,5];case 4:return a=s.sent(),console.error("Error fetching data:",a),y("Ошибка при загрузке данных. Проверьте консоль для деталей."),m(!1),[3,5];case 5:return[3,7];case 6:return i=s.sent(),console.error("General error:",i),y("Ошибка при загрузке данных"),m(!1),[3,7];case 7:return[2]}}))}))}),[e,D]);var P=function(e){var t=e.target,n=t.name,r=t.value,a=t.type;if(console.log("Input change - name: ".concat(n,", value: ").concat(r,", type: ").concat(a)),"first_name"!==n&&"last_name"!==n||(r.trim().length<2?q((function(e){var t;return l(l({},e),((t={})[n]="Минимум 2 символа",t))})):q((function(e){var t;return l(l({},e),((t={})[n]=null,t))}))),"email"===n&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r)?q((function(e){return l(l({},e),{email:null})})):q((function(e){return l(l({},e),{email:"Некорректный email"})}))),"position"===n&&r.trim().length<2?q((function(e){return l(l({},e),{position:"Минимум 2 символа"})})):"position"===n&&q((function(e){return l(l({},e),{position:null})})),"department_id"===n)E((function(e){var t;return l(l({},e),((t={})[n]=""===r?null:Number(r),t))}));else if("checkbox"===a){var i=e.target.checked;E((function(e){var t;return l(l({},e),((t={})[n]=i,t))}))}else E((function(e){var t;return l(l({},e),((t={})[n]=r,t))}))},V=function(){return D?""!==S.first_name||""!==S.last_name||""!==S.email||""!==S.position:JSON.stringify(S)!==JSON.stringify(j)},$=function(){var e,t,n,r;return!Object.values(F).some((function(e){return null!==e}))&&""!==(null===(e=S.first_name)||void 0===e?void 0:e.trim())&&""!==(null===(t=S.last_name)||void 0===t?void 0:t.trim())&&""!==(null===(n=S.email)||void 0===n?void 0:n.trim())&&""!==(null===(r=S.position)||void 0===r?void 0:r.trim())};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,r.jsx)("h2",{children:D?"Добавление сотрудника":"Редактирование сотрудника"}),(0,r.jsxs)(s.N_,{to:D?"/employees":"/employees/".concat(e),className:"btn btn-outline-secondary",children:[(0,r.jsx)("i",{className:"bi bi-arrow-left"})," Назад"]})]}),d?(0,r.jsx)("div",{className:"d-flex justify-content-center",children:(0,r.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,r.jsx)("span",{className:"visually-hidden",children:"Загрузка..."})})}):b?(0,r.jsxs)("div",{className:"alert alert-danger",children:[(0,r.jsx)("i",{className:"bi bi-exclamation-triangle-fill me-2"}),b]}):x?(0,r.jsxs)("div",{className:"alert alert-success",children:[(0,r.jsx)("i",{className:"bi bi-check-circle-fill me-2"}),x]}):(0,r.jsx)("div",{className:"card",children:(0,r.jsx)("div",{className:"card-body",children:(0,r.jsxs)("form",{onSubmit:function(n){return c(void 0,void 0,void 0,(function(){var r,a,i,s;return u(this,(function(c){switch(c.label){case 0:if(n.preventDefault(),!$())return y("Пожалуйста, исправьте ошибки в форме"),[2];c.label=1;case 1:return c.trys.push([1,6,,7]),h(!0),y(null),r=l(l({},S),{department_id:void 0===S.department_id||null===S.department_id?null:Number(S.department_id)}),D?(console.log("Creating new employee with data:",r),[4,(0,o.bV)(r)]):[3,3];case 2:return a=c.sent(),_("Сотрудник успешно создан"),[3,5];case 3:return i=Number(e),isNaN(i)?(y("Некорректный ID сотрудника"),h(!1),[2]):(console.log("Updating employee data:",r),console.log("Employee ID for update:",i),[4,(0,o.Y$)(i,r)]);case 4:a=c.sent(),_("Данные успешно сохранены"),c.label=5;case 5:return h(!1),N(a),setTimeout((function(){t("/employees/".concat(a.id))}),1500),[3,7];case 6:return s=c.sent(),h(!1),console.error("Ошибка при сохранении:",s),s.response&&s.response.data&&s.response.data.error?y("Ошибка при сохранении: ".concat(s.response.data.error)):y("Ошибка при сохранении данных сотрудника. Проверьте правильность заполнения полей."),[3,7];case 7:return[2]}}))}))},children:[(0,r.jsxs)("div",{className:"row mb-3",children:[(0,r.jsxs)("div",{className:"col-md-6",children:[(0,r.jsx)("label",{htmlFor:"first_name",className:"form-label",children:"Имя"}),(0,r.jsx)("input",{type:"text",className:"form-control ".concat(F.first_name?"is-invalid":""),id:"first_name",name:"first_name",value:S.first_name||"",onChange:P,required:!0}),F.first_name&&(0,r.jsx)("div",{className:"invalid-feedback",children:F.first_name})]}),(0,r.jsxs)("div",{className:"col-md-6",children:[(0,r.jsx)("label",{htmlFor:"last_name",className:"form-label",children:"Фамилия"}),(0,r.jsx)("input",{type:"text",className:"form-control ".concat(F.last_name?"is-invalid":""),id:"last_name",name:"last_name",value:S.last_name||"",onChange:P,required:!0}),F.last_name&&(0,r.jsx)("div",{className:"invalid-feedback",children:F.last_name})]})]}),(0,r.jsxs)("div",{className:"row mb-3",children:[(0,r.jsxs)("div",{className:"col-md-6",children:[(0,r.jsx)("label",{htmlFor:"email",className:"form-label",children:"Email"}),(0,r.jsx)("input",{type:"email",className:"form-control ".concat(F.email?"is-invalid":""),id:"email",name:"email",value:S.email||"",onChange:P,required:!0}),F.email&&(0,r.jsx)("div",{className:"invalid-feedback",children:F.email})]}),(0,r.jsxs)("div",{className:"col-md-6",children:[(0,r.jsx)("label",{htmlFor:"position",className:"form-label",children:"Должность"}),(0,r.jsx)("input",{type:"text",className:"form-control ".concat(F.position?"is-invalid":""),id:"position",name:"position",value:S.position||"",onChange:P,required:!0}),F.position&&(0,r.jsx)("div",{className:"invalid-feedback",children:F.position})]})]}),(0,r.jsxs)("div",{className:"row mb-3",children:[(0,r.jsxs)("div",{className:"col-md-6",children:[(0,r.jsx)("label",{htmlFor:"department_id",className:"form-label",children:"Отдел"}),(0,r.jsxs)("select",{className:"form-select",id:"department_id",name:"department_id",value:null===S.department_id?"":String(S.department_id),onChange:P,children:[(0,r.jsx)("option",{value:"",children:"Выберите отдел"}),C.map((function(e){return(0,r.jsx)("option",{value:String(e.id),children:e.name},e.id)}))]})]}),(0,r.jsx)("div",{className:"col-md-6",children:(0,r.jsxs)("div",{className:"form-check mt-4",children:[(0,r.jsx)("input",{className:"form-check-input",type:"checkbox",id:"is_active",name:"is_active",checked:S.is_active||!1,onChange:P}),(0,r.jsx)("label",{className:"form-check-label",htmlFor:"is_active",children:"Активен"})]})})]}),(0,r.jsxs)("div",{className:"mt-4 d-flex",children:[(0,r.jsx)("button",{type:"submit",className:"btn btn-primary me-2",disabled:p||!V()||!$(),children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Сохранение..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("i",{className:"bi bi-save me-1"})," ",D?"Создать сотрудника":"Сохранить изменения"]})}),(0,r.jsxs)("button",{type:"button",className:"btn btn-outline-secondary me-2",onClick:function(){E(j),q({first_name:null,last_name:null,email:null,position:null})},disabled:!V(),children:[(0,r.jsx)("i",{className:"bi bi-arrow-counterclockwise me-1"})," Сбросить"]}),(0,r.jsxs)(s.N_,{to:D?"/employees":"/employees/".concat(e),className:"btn btn-outline-danger",children:[(0,r.jsx)("i",{className:"bi bi-x-circle me-1"})," Отмена"]})]})]})})})]})}}}]);