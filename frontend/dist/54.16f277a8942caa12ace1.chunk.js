"use strict";(self.webpackChunktime_tracking_system_frontend=self.webpackChunktime_tracking_system_frontend||[]).push([[54],{3661:(e,t,s)=>{s.d(t,{DG:()=>v,Oc:()=>d,Y$:()=>b,aJ:()=>u,ap:()=>j,ax:()=>l,b$:()=>x,bV:()=>h,is:()=>f,l3:()=>m,w$:()=>p,z9:()=>y});var n=s(1083),r=function(e,t,s,n){return new(s||(s=Promise))((function(r,a){function i(e){try{o(n.next(e))}catch(e){a(e)}}function c(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,c)}o((n=n.apply(e,t||[])).next())}))},a=function(e,t){var s,n,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(o){return function(c){if(s)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(s=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{s=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,o])}}},i=function(e,t,s){if(s||2===arguments.length)for(var n,r=0,a=t.length;r<a;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},c=n.A.create({baseURL:"/api",timeout:3e4}),o=function(e,t){if(console.error("API Error:",e),n.A.isAxiosError(e)){var s=e;if(s.response){var r=s.response.data,a=r&&"object"==typeof r?r.error||r.message||JSON.stringify(r):"Ошибка сервера";throw new Error("".concat(t||"Ошибка API",": ").concat(a))}throw s.request?new Error("Сервер не отвечает. Проверьте соединение с интернетом"):new Error("Ошибка при выполнении запроса: ".concat(s.message))}throw new Error(t||"Неизвестная ошибка при запросе к API")},l=function(){return r(void 0,void 0,void 0,(function(){var e,t,s;return a(this,(function(n){switch(n.label){case 0:return console.log("Запрос отделов начат"),[4,c.get("/departments")];case 1:return e=n.sent(),console.log("Получен ответ по отделам:",e.data),t=e.data.items,console.log("Отделы (массив):",t),s=t.filter((function(e,t,s){return t===s.findIndex((function(t){return t.id===e.id}))})),console.log("Уникальные отделы после фильтрации:",s),[2,s]}}))}))},d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(void 0,i([],e,!0),void 0,(function(e,t,s,n,r){var i;return void 0===e&&(e=1),void 0===t&&(t=20),a(this,(function(a){switch(a.label){case 0:return i={page:e,per_page:t},s&&(i.department_id=s),void 0!==n&&(i.is_active=n),r&&(i.search=r),[4,c.get("/employees",{params:i})];case 1:return[2,a.sent().data]}}))}))},u=function(){return r(void 0,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,c.get("/employees/with-open-records")];case 1:return[2,e.sent().data.items||[]]}}))}))},m=function(e){return r(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,c.get("/employees/".concat(e))];case 1:return[2,t.sent().data]}}))}))},h=function(e){return r(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,c.post("/employees",e)];case 1:return[2,t.sent().data]}}))}))},b=function(e,t){return r(void 0,void 0,void 0,(function(){var s,n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),console.log("Updating employee with data:",t),[4,c.put("/employees/".concat(e),t)];case 1:return s=r.sent(),console.log("Employee update response:",s.data),[2,s.data];case 2:throw n=r.sent(),console.error("Error updating employee:",n),n;case 3:return[2]}}))}))},p=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(void 0,i([],e,!0),void 0,(function(e,t,s,n,r){var i;return void 0===e&&(e=1),void 0===t&&(t=20),a(this,(function(a){switch(a.label){case 0:return i={page:e,per_page:t},s&&(i.employee_id=s),n&&(i.start_date=n),r&&(i.end_date=r),[4,c.get("/time-records",{params:i})];case 1:return[2,a.sent().data]}}))}))},f=function(e,t){return r(void 0,void 0,void 0,(function(){return a(this,(function(s){switch(s.label){case 0:return[4,c.post("/time-records/check-in",{employee_id:e,description:t})];case 1:return[2,s.sent().data]}}))}))},x=function(e,t){return r(void 0,void 0,void 0,(function(){return a(this,(function(s){switch(s.label){case 0:return[4,c.post("/time-records/check-out",{employee_id:e,description:t})];case 1:return[2,s.sent().data]}}))}))},v=function(e,t){for(var s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];return r(void 0,i([e,t],s,!0),void 0,(function(e,t,s,n){var r,i,l;return void 0===s&&(s="employee"),a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r={start_date:e,end_date:t,group_by:s},n&&(r.department_id=n),console.log("Request params for summary report:",r),[4,c.get("/reports/summary",{params:r})];case 1:if(i=a.sent(),console.log("Summary report API response:",i.data),!i.data||!i.data.period||!i.data.data)throw new Error("Неверный формат ответа от сервера");return[2,i.data];case 2:throw l=a.sent(),o(l,"Ошибка при получении сводного отчета"),l;case 3:return[2]}}))}))},j=function(e,t,s){return r(void 0,void 0,void 0,(function(){var n,r,i;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n={date:e},t&&(n.employee_id=t),s&&(n.department_id=s),console.log("Request params for daily report:",n),[4,c.get("/reports/daily",{params:n})];case 1:if(r=a.sent(),console.log("Daily report API response:",r.data),!r.data||!r.data.date||!r.data.records)throw new Error("Неверный формат ответа от сервера");return[2,r.data];case 2:throw i=a.sent(),o(i,"Ошибка при получении ежедневного отчета"),i;case 3:return[2]}}))}))},y=function(e,t){for(var s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];return r(void 0,i([e,t],s,!0),void 0,(function(e,t,s,n){var r,i,l;return void 0===s&&(s="summary"),a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r={start_date:e,end_date:t,type:s},n&&(r.department_id=n),console.log("Request params for CSV export:",r),[4,c.get("/reports/export/csv",{params:r})];case 1:if(i=a.sent(),console.log("CSV export response received"),!i.data||!i.data.csv_data||!i.data.filename)throw new Error("Неверный формат ответа от сервера при экспорте CSV");return[2,i.data];case 2:throw l=a.sent(),o(l,"Ошибка при экспорте CSV"),l;case 3:return[2]}}))}))}},4054:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var n=s(4848),r=s(6540),a=s(7767),i=s(4976),c=s(3661),o=function(e,t,s,n){return new(s||(s=Promise))((function(r,a){function i(e){try{o(n.next(e))}catch(e){a(e)}}function c(e){try{o(n.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,c)}o((n=n.apply(e,t||[])).next())}))},l=function(e,t){var s,n,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(o){return function(c){if(s)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(s=1,n&&(r=2&c[0]?n.return:c[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,c[1])).done)return r;switch(n=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{s=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,o])}}};const d=function(){var e=(0,a.g)().id,t=((0,a.Zp)(),(0,r.useState)(null)),s=t[0],d=t[1],u=(0,r.useState)(!0),m=u[0],h=u[1],b=(0,r.useState)(null),p=b[0],f=b[1],x=(0,r.useState)([]),v=x[0],j=x[1],y=(0,r.useState)(!1),g=y[0],N=y[1],w=(0,r.useState)(!1),_=w[0],k=w[1],S=(0,r.useState)(null),E=S[0],I=S[1];(0,r.useEffect)((function(){o(void 0,void 0,void 0,(function(){var t,s;return l(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e?[4,(0,c.l3)(parseInt(e))]:(f("ID сотрудника не указан"),h(!1),[2]);case 1:return t=n.sent(),d(t),[4,(0,c.w$)(1,5,parseInt(e))];case 2:return s=n.sent(),j(s.items),h(!1),[3,4];case 3:return n.sent(),f("Ошибка при загрузке данных сотрудника"),h(!1),[3,4];case 4:return[2]}}))}))}),[e]);var A,C=function(e){return new Date(e).toLocaleString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})};return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,n.jsx)("h2",{children:"Информация о сотруднике"}),(0,n.jsxs)("div",{children:[s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.N_,{to:"/employees/".concat(s.id,"/edit"),className:"btn btn-primary me-2",children:[(0,n.jsx)("i",{className:"bi bi-pencil"})," Редактировать"]}),(0,n.jsxs)("button",{className:"btn ".concat(s.is_active?"btn-outline-danger":"btn-outline-success"," me-2"),onClick:function(){return N(!0)},children:[(0,n.jsx)("i",{className:"bi ".concat(s.is_active?"bi-person-x":"bi-person-check"," me-1")}),s.is_active?"Деактивировать":"Активировать"]})]}),(0,n.jsxs)(i.N_,{to:"/employees",className:"btn btn-outline-secondary",children:[(0,n.jsx)("i",{className:"bi bi-arrow-left"})," Назад к списку"]})]})]}),E&&(0,n.jsxs)("div",{className:"alert ".concat("success"===E.type?"alert-success":"alert-danger"," alert-dismissible fade show"),children:[(0,n.jsx)("i",{className:"bi ".concat("success"===E.type?"bi-check-circle":"bi-exclamation-triangle"," me-2")}),E.text,(0,n.jsx)("button",{type:"button",className:"btn-close",onClick:function(){return I(null)}})]}),g&&(0,n.jsx)("div",{className:"alert alert-warning mb-4",children:(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Подтверждение:"})," Вы уверены, что хотите ",(null==s?void 0:s.is_active)?"деактивировать":"активировать"," сотрудника?"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{className:"btn btn-sm btn-warning me-2",onClick:function(){return o(void 0,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:if(!s||!e)return[2];n.label=1;case 1:return n.trys.push([1,3,4,5]),k(!0),[4,(0,c.Y$)(parseInt(e),{is_active:!s.is_active})];case 2:return t=n.sent(),d(t),N(!1),I({type:"success",text:"Сотрудник ".concat(s.is_active?"деактивирован":"активирован"," успешно")}),setTimeout((function(){I(null)}),3e3),[3,5];case 3:return n.sent(),I({type:"error",text:"Ошибка при изменении статуса сотрудника"}),[3,5];case 4:return k(!1),[7];case 5:return[2]}}))}))},disabled:_,children:_?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"spinner-border spinner-border-sm me-1"})," Обработка..."]}):(0,n.jsx)(n.Fragment,{children:"Да, подтверждаю"})}),(0,n.jsx)("button",{className:"btn btn-sm btn-secondary",onClick:function(){return N(!1)},disabled:_,children:"Отмена"})]})]})}),m?(0,n.jsx)("div",{className:"d-flex justify-content-center",children:(0,n.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,n.jsx)("span",{className:"visually-hidden",children:"Загрузка..."})})}):p?(0,n.jsx)("div",{className:"alert alert-danger",children:p}):s?(0,n.jsx)("div",{className:"card",children:(0,n.jsxs)("div",{className:"card-body",children:[(0,n.jsxs)("div",{className:"row mb-4",children:[(0,n.jsxs)("div",{className:"col-md-2",children:[(0,n.jsx)("div",{className:"employee-avatar bg-light rounded-circle d-flex justify-content-center align-items-center mb-3",style:{width:"120px",height:"120px"},children:(0,n.jsx)("i",{className:"bi bi-person",style:{fontSize:"3rem"}})}),(0,n.jsxs)("div",{className:"badge ".concat((A=s.is_active,A?"bg-success":"bg-danger")," mb-2 d-inline-block px-3 py-2"),children:[(0,n.jsx)("i",{className:"bi ".concat(s.is_active?"bi-check-circle":"bi-x-circle"," me-1")}),s.is_active?"Активен":"Неактивен"]})]}),(0,n.jsxs)("div",{className:"col-md-10",children:[(0,n.jsxs)("h3",{children:[s.first_name," ",s.last_name]}),(0,n.jsxs)("p",{className:"text-muted mb-2",children:[(0,n.jsx)("i",{className:"bi bi-briefcase me-1"}),s.position]}),(0,n.jsxs)("p",{className:"text-muted mb-3",children:[(0,n.jsx)("i",{className:"bi bi-building me-1"}),"Отдел: ",s.department_name||"Не указан"]}),(0,n.jsx)("hr",{}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("div",{className:"col-md-6",children:[(0,n.jsxs)("p",{children:[(0,n.jsxs)("strong",{children:[(0,n.jsx)("i",{className:"bi bi-envelope me-1"})," Email:"]}),(0,n.jsx)("a",{href:"mailto:".concat(s.email),className:"text-decoration-none ms-1",children:s.email})]}),(0,n.jsxs)("p",{children:[(0,n.jsxs)("strong",{children:[(0,n.jsx)("i",{className:"bi bi-hash me-1"})," ID:"]})," ",s.id]})]}),(0,n.jsxs)("div",{className:"col-md-6",children:[(0,n.jsxs)("p",{children:[(0,n.jsxs)("strong",{children:[(0,n.jsx)("i",{className:"bi bi-calendar-plus me-1"})," Дата создания:"]})," ",C(s.created_at)]}),(0,n.jsxs)("p",{children:[(0,n.jsxs)("strong",{children:[(0,n.jsx)("i",{className:"bi bi-calendar-check me-1"})," Дата обновления:"]})," ",C(s.updated_at)]})]})]})]})]}),(0,n.jsx)("div",{className:"row",children:(0,n.jsxs)("div",{className:"col-12",children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,n.jsxs)("h5",{className:"mb-0",children:[(0,n.jsx)("i",{className:"bi bi-clock-history me-2"}),"Последние записи времени"]}),(0,n.jsxs)(i.N_,{to:"/time-records?employee_id=".concat(s.id),className:"btn btn-sm btn-outline-primary",children:[(0,n.jsx)("i",{className:"bi bi-list me-1"})," Все записи"]})]}),v.length>0?(0,n.jsx)("div",{className:"table-responsive",children:(0,n.jsxs)("table",{className:"table table-sm table-bordered table-hover",children:[(0,n.jsx)("thead",{className:"table-light",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Дата"}),(0,n.jsx)("th",{children:"Приход"}),(0,n.jsx)("th",{children:"Уход"}),(0,n.jsx)("th",{children:"Время (ч)"}),(0,n.jsx)("th",{children:"Описание"})]})}),(0,n.jsx)("tbody",{children:v.map((function(e){var t;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:new Date(e.check_in).toLocaleDateString()}),(0,n.jsx)("td",{children:new Date(e.check_in).toLocaleTimeString()}),(0,n.jsx)("td",{children:e.check_out?new Date(e.check_out).toLocaleTimeString():(0,n.jsx)("span",{className:"badge bg-warning text-dark",children:"В процессе"})}),(0,n.jsx)("td",{children:(null===(t=e.duration_hours)||void 0===t?void 0:t.toFixed(2))||"-"}),(0,n.jsx)("td",{children:e.description||"-"})]},e.id)}))})]})}):(0,n.jsxs)("div",{className:"alert alert-info",children:[(0,n.jsx)("i",{className:"bi bi-info-circle me-2"}),"Нет записей о рабочем времени"]})]})}),(0,n.jsx)("hr",{className:"my-4"}),(0,n.jsx)("div",{className:"row",children:(0,n.jsxs)("div",{className:"col-12",children:[(0,n.jsxs)("h5",{className:"mb-3",children:[(0,n.jsx)("i",{className:"bi bi-ui-checks-grid me-2"}),"Действия"]}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsx)("div",{className:"col-md-6",children:(0,n.jsx)("div",{className:"card bg-light mb-3",children:(0,n.jsxs)("div",{className:"card-body",children:[(0,n.jsxs)("h6",{className:"card-title",children:[(0,n.jsx)("i",{className:"bi bi-graph-up me-2"}),"Статистика рабочего времени"]}),(0,n.jsx)("p",{className:"card-text",children:'Доступ к детальной статистике рабочего времени можно получить в разделе "Отчеты".'}),(0,n.jsxs)(i.N_,{to:"/reports?employee_id=".concat(s.id),className:"btn btn-sm btn-outline-primary",children:[(0,n.jsx)("i",{className:"bi bi-graph-up"})," Просмотр статистики"]})]})})}),(0,n.jsx)("div",{className:"col-md-6",children:(0,n.jsx)("div",{className:"card bg-light mb-3",children:(0,n.jsxs)("div",{className:"card-body",children:[(0,n.jsxs)("h6",{className:"card-title",children:[(0,n.jsx)("i",{className:"bi bi-clock me-2"}),"Регистрация времени"]}),(0,n.jsx)("p",{className:"card-text",children:"Отметить приход или уход сотрудника."}),(0,n.jsxs)("div",{className:"btn-group btn-group-sm",children:[(0,n.jsxs)(i.N_,{to:"/time-records/check-in?employee_id=".concat(s.id),className:"btn btn-outline-success",children:[(0,n.jsx)("i",{className:"bi bi-box-arrow-in-right"})," Отметить приход"]}),(0,n.jsxs)(i.N_,{to:"/time-records/check-out?employee_id=".concat(s.id),className:"btn btn-outline-danger",children:[(0,n.jsx)("i",{className:"bi bi-box-arrow-left"})," Отметить уход"]})]})]})})})]})]})})]})}):(0,n.jsxs)("div",{className:"alert alert-info",children:[(0,n.jsx)("i",{className:"bi bi-person-x me-2"}),"Сотрудник не найден"]})]})}}}]);