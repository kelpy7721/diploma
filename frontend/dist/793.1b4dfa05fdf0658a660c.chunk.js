"use strict";(self.webpackChunktime_tracking_system_frontend=self.webpackChunktime_tracking_system_frontend||[]).push([[793],{3661:(e,t,r)=>{r.d(t,{DG:()=>y,Oc:()=>u,Y$:()=>h,aJ:()=>d,ap:()=>w,ax:()=>l,b$:()=>b,bV:()=>p,is:()=>v,l3:()=>f,w$:()=>m,z9:()=>g});var n=r(1083),a=function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((n=n.apply(e,t||[])).next())}))},s=function(e,t){var r,n,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(s=0)),s;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},o=function(e,t,r){if(r||2===arguments.length)for(var n,a=0,s=t.length;a<s;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},i=n.A.create({baseURL:"/api",timeout:3e4}),c=function(e,t){if(console.error("API Error:",e),n.A.isAxiosError(e)){var r=e;if(r.response){var a=r.response.data,s=a&&"object"==typeof a?a.error||a.message||JSON.stringify(a):"Ошибка сервера";throw new Error("".concat(t||"Ошибка API",": ").concat(s))}throw r.request?new Error("Сервер не отвечает. Проверьте соединение с интернетом"):new Error("Ошибка при выполнении запроса: ".concat(r.message))}throw new Error(t||"Неизвестная ошибка при запросе к API")},l=function(){return a(void 0,void 0,void 0,(function(){var e,t,r;return s(this,(function(n){switch(n.label){case 0:return console.log("Запрос отделов начат"),[4,i.get("/departments")];case 1:return e=n.sent(),console.log("Получен ответ по отделам:",e.data),t=e.data.items,console.log("Отделы (массив):",t),r=t.filter((function(e,t,r){return t===r.findIndex((function(t){return t.id===e.id}))})),console.log("Уникальные отделы после фильтрации:",r),[2,r]}}))}))},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,o([],e,!0),void 0,(function(e,t,r,n,a){var o;return void 0===e&&(e=1),void 0===t&&(t=20),s(this,(function(s){switch(s.label){case 0:return o={page:e,per_page:t},r&&(o.department_id=r),void 0!==n&&(o.is_active=n),a&&(o.search=a),[4,i.get("/employees",{params:o})];case 1:return[2,s.sent().data]}}))}))},d=function(){return a(void 0,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,i.get("/employees/with-open-records")];case 1:return[2,e.sent().data.items||[]]}}))}))},f=function(e){return a(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,i.get("/employees/".concat(e))];case 1:return[2,t.sent().data]}}))}))},p=function(e){return a(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,i.post("/employees",e)];case 1:return[2,t.sent().data]}}))}))},h=function(e,t){return a(void 0,void 0,void 0,(function(){var r,n;return s(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),console.log("Updating employee with data:",t),[4,i.put("/employees/".concat(e),t)];case 1:return r=a.sent(),console.log("Employee update response:",r.data),[2,r.data];case 2:throw n=a.sent(),console.error("Error updating employee:",n),n;case 3:return[2]}}))}))},m=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,o([],e,!0),void 0,(function(e,t,r,n,a){var o;return void 0===e&&(e=1),void 0===t&&(t=20),s(this,(function(s){switch(s.label){case 0:return o={page:e,per_page:t},r&&(o.employee_id=r),n&&(o.start_date=n),a&&(o.end_date=a),[4,i.get("/time-records",{params:o})];case 1:return[2,s.sent().data]}}))}))},v=function(e,t){return a(void 0,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,i.post("/time-records/check-in",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},b=function(e,t){return a(void 0,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return[4,i.post("/time-records/check-out",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},y=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return a(void 0,o([e,t],r,!0),void 0,(function(e,t,r,n){var a,o,l;return void 0===r&&(r="employee"),s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a={start_date:e,end_date:t,group_by:r},n&&(a.department_id=n),console.log("Request params for summary report:",a),[4,i.get("/reports/summary",{params:a})];case 1:if(o=s.sent(),console.log("Summary report API response:",o.data),!o.data||!o.data.period||!o.data.data)throw new Error("Неверный формат ответа от сервера");return[2,o.data];case 2:throw l=s.sent(),c(l,"Ошибка при получении сводного отчета"),l;case 3:return[2]}}))}))},w=function(e,t,r){return a(void 0,void 0,void 0,(function(){var n,a,o;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),n={date:e},t&&(n.employee_id=t),r&&(n.department_id=r),console.log("Request params for daily report:",n),[4,i.get("/reports/daily",{params:n})];case 1:if(a=s.sent(),console.log("Daily report API response:",a.data),!a.data||!a.data.date||!a.data.records)throw new Error("Неверный формат ответа от сервера");return[2,a.data];case 2:throw o=s.sent(),c(o,"Ошибка при получении ежедневного отчета"),o;case 3:return[2]}}))}))},g=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return a(void 0,o([e,t],r,!0),void 0,(function(e,t,r,n){var a,o,l;return void 0===r&&(r="summary"),s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),a={start_date:e,end_date:t,type:r},n&&(a.department_id=n),console.log("Request params for CSV export:",a),[4,i.get("/reports/export/csv",{params:a})];case 1:if(o=s.sent(),console.log("CSV export response received"),!o.data||!o.data.csv_data||!o.data.filename)throw new Error("Неверный формат ответа от сервера при экспорте CSV");return[2,o.data];case 2:throw l=s.sent(),c(l,"Ошибка при экспорте CSV"),l;case 3:return[2]}}))}))}},6793:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(4848),a=r(6540),s=r(7767),o=r(4976),i=r(3661),c=function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((n=n.apply(e,t||[])).next())}))},l=function(e,t){var r,n,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(s=0)),s;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((a=(a=s.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};const u=function(){var e=(0,a.useState)(!0),t=e[0],r=e[1],u=(0,a.useState)(!1),d=u[0],f=u[1],p=(0,a.useState)([]),h=p[0],m=p[1],v=(0,a.useState)(""),b=v[0],y=v[1],w=(0,a.useState)(""),g=w[0],x=w[1],j=(0,a.useState)(null),_=j[0],N=j[1],S=(0,a.useState)(null),k=S[0],E=S[1],I=(0,s.Zp)(),A=(0,s.zy)();return(0,a.useEffect)((function(){c(void 0,void 0,void 0,(function(){var e,t,n;return l(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,(0,i.aJ)()];case 1:return e=a.sent(),m(e),t=new URLSearchParams(A.search),(n=t.get("employee_id"))&&y(parseInt(n)),r(!1),[3,3];case 2:return a.sent(),N("Ошибка при загрузке списка сотрудников"),r(!1),[3,3];case 3:return[2]}}))}))}),[A.search]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,n.jsx)("h2",{children:"Отметка ухода"}),(0,n.jsxs)(o.N_,{to:A.search.includes("employee_id")?"/employees/".concat(b):"/",className:"btn btn-outline-primary",children:[(0,n.jsx)("i",{className:"bi bi-arrow-left me-1"}),"Назад"]})]}),(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("div",{className:"col-md-6 offset-md-3",children:(0,n.jsx)("div",{className:"card",children:(0,n.jsxs)("div",{className:"card-body",children:[k&&(0,n.jsxs)("div",{className:"alert alert-success",children:[(0,n.jsx)("i",{className:"bi bi-check-circle me-2"}),k]}),_&&(0,n.jsxs)("div",{className:"alert alert-danger",children:[(0,n.jsx)("i",{className:"bi bi-exclamation-triangle me-2"}),_]}),t?(0,n.jsxs)("div",{className:"text-center py-4",children:[(0,n.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,n.jsx)("span",{className:"visually-hidden",children:"Загрузка..."})}),(0,n.jsx)("p",{className:"mt-2 text-muted",children:"Загрузка списка сотрудников..."})]}):(0,n.jsxs)("form",{onSubmit:function(e){return c(void 0,void 0,void 0,(function(){var t,r,n,a;return l(this,(function(s){switch(s.label){case 0:if(e.preventDefault(),!b)return N("Необходимо выбрать сотрудника"),[2];f(!0),N(null),s.label=1;case 1:return s.trys.push([1,3,4,5]),[4,(0,i.b$)(Number(b),g)];case 2:return s.sent(),E("Уход успешно отмечен!"),y(""),x(""),setTimeout((function(){var e=new URLSearchParams(A.search).get("employee_id");I(e?"/employees/".concat(e):"/")}),2e3),[3,5];case 3:return t=s.sent(),r=(null===(a=null===(n=t.response)||void 0===n?void 0:n.data)||void 0===a?void 0:a.error)||"Произошла ошибка при отметке ухода",N(r),[3,5];case 4:return f(!1),[7];case 5:return[2]}}))}))},children:[0===h.length?(0,n.jsxs)("div",{className:"alert alert-warning",children:[(0,n.jsx)("i",{className:"bi bi-exclamation-triangle me-2"}),"Открытая запись не найдена для этого сотрудника"]}):(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{htmlFor:"employee",className:"form-label",children:"Выберите сотрудника"}),(0,n.jsxs)("select",{id:"employee",className:"form-select",value:b,onChange:function(e){return y(e.target.value?Number(e.target.value):"")},disabled:d||A.search.includes("employee_id"),required:!0,children:[(0,n.jsx)("option",{value:"",children:"-- Выберите сотрудника --"}),h.map((function(e){return(0,n.jsxs)("option",{value:e.id,children:[e.last_name," ",e.first_name," (",e.position,")"]},e.id)}))]})]}),h.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{htmlFor:"description",className:"form-label",children:"Комментарий (опционально)"}),(0,n.jsx)("textarea",{id:"description",className:"form-control",value:g,onChange:function(e){return x(e.target.value)},disabled:d,placeholder:"Например: Выполнено задач: 5",rows:3})]}),(0,n.jsx)("div",{className:"d-grid",children:(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:d,children:d?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Обработка..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("i",{className:"bi bi-box-arrow-left me-2"}),"Отметить уход"]})})})]})]})]})})})})]})}}}]);