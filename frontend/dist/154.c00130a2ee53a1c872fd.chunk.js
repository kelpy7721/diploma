"use strict";(self.webpackChunktime_tracking_system_frontend=self.webpackChunktime_tracking_system_frontend||[]).push([[154],{3154:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(4848),a=r(6540),i=r(7767),o=r(4976),s=r(3661),c=r(5739),l=function(){return l=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},l.apply(this,arguments)};const u=function(){var e=(0,i.Zp)(),t=(0,i.zy)(),r=new URLSearchParams(t.search),u=parseInt(r.get("page")||"1"),d=(0,a.useState)(!0),p=d[0],h=d[1],f=(0,a.useState)([]),m=f[0],v=f[1],g=(0,a.useState)({total:0,pages:0,page:u}),y=g[0],b=g[1],w=(0,a.useState)(null),x=w[0],j=w[1];(0,a.useEffect)((function(){var e,t,r,n;e=void 0,t=void 0,n=function(){var e;return function(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),h(!0),[4,(0,s.w$)(y.page,10)];case 1:return e=t.sent(),v(e.items),b({total:e.total,pages:e.pages,page:e.page}),h(!1),[3,3];case 2:return t.sent(),j("Ошибка при загрузке данных"),h(!1),[3,3];case 3:return[2]}}))},new((r=void 0)||(r=Promise))((function(a,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))}),[y.page]);var _=function(t){t<1||t>y.pages||(e("/time-records?page=".concat(t)),b((function(e){return l(l({},e),{page:t})})))};return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,n.jsx)("h2",{children:"Учёт рабочего времени"}),(0,n.jsxs)("div",{children:[(0,n.jsx)(o.N_,{to:"/time-records/check-in",className:"btn btn-success me-2",children:"Отметить приход"}),(0,n.jsx)(o.N_,{to:"/time-records/check-out",className:"btn btn-warning me-2",children:"Отметить уход"}),(0,n.jsx)(o.N_,{to:"/time-records/new",className:"btn btn-primary",children:"Новая запись"})]})]}),p?(0,n.jsx)("div",{className:"d-flex justify-content-center my-5",children:(0,n.jsx)("div",{className:"spinner-border text-primary",role:"status",children:(0,n.jsx)("span",{className:"visually-hidden",children:"Загрузка..."})})}):x?(0,n.jsx)("div",{className:"alert alert-danger",children:x}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"card",children:(0,n.jsx)("div",{className:"card-body",children:(0,n.jsx)("div",{className:"table-responsive",children:(0,n.jsxs)("table",{className:"table table-striped",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"ID"}),(0,n.jsx)("th",{children:"Сотрудник"}),(0,n.jsx)("th",{children:"Дата"}),(0,n.jsx)("th",{children:"Начало"}),(0,n.jsx)("th",{children:"Окончание"}),(0,n.jsx)("th",{children:"Часов"}),(0,n.jsx)("th",{children:"Описание"})]})}),(0,n.jsx)("tbody",{children:m.map((function(e){return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.id}),(0,n.jsx)("td",{children:e.employee_name}),(0,n.jsx)("td",{children:(0,c.EU)(e.check_in)}),(0,n.jsx)("td",{children:(0,c.Nl)(e.check_in)}),(0,n.jsx)("td",{children:e.check_out?(0,c.Nl)(e.check_out):(0,n.jsx)("span",{className:"badge bg-warning text-dark",children:"В процессе"})}),(0,n.jsx)("td",{children:e.duration_hours.toFixed(2)}),(0,n.jsx)("td",{children:e.description})]},e.id)}))})]})})})}),(0,n.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("p",{className:"mb-0",children:["Всего записей: ",y.total,", Страница: ",y.page," из"," ",y.pages]})}),y.pages>1&&(0,n.jsx)("nav",{"aria-label":"Page navigation",children:(0,n.jsxs)("ul",{className:"pagination",children:[(0,n.jsx)("li",{className:"page-item ".concat(1===y.page?"disabled":""),children:(0,n.jsx)("button",{className:"page-link",onClick:function(){return _(y.page-1)},disabled:1===y.page,children:(0,n.jsx)("i",{className:"bi bi-chevron-left"})})}),function(){for(var e=[],t=y.pages,r=y.page,n=1;n<=t;n++)1===n||n===t||n>=r-2&&n<=r+2?e.push(n):(n===r-2-1&&n>1||n===r+2+1&&n<t)&&e.push(-1);return e}().map((function(e,t){return-1===e?(0,n.jsx)("li",{className:"page-item disabled",children:(0,n.jsx)("span",{className:"page-link",children:"..."})},"ellipsis-".concat(t)):(0,n.jsx)("li",{className:"page-item ".concat(e===y.page?"active":""),children:(0,n.jsx)("button",{className:"page-link",onClick:function(){return _(e)},children:e})},e)})),(0,n.jsx)("li",{className:"page-item ".concat(y.page===y.pages?"disabled":""),children:(0,n.jsx)("button",{className:"page-link",onClick:function(){return _(y.page+1)},disabled:y.page===y.pages,children:(0,n.jsx)("i",{className:"bi bi-chevron-right"})})})]})})]})]})]})}},3661:(e,t,r)=>{r.d(t,{DG:()=>y,Oc:()=>u,Y$:()=>f,aJ:()=>d,ap:()=>b,ax:()=>l,b$:()=>g,bV:()=>h,is:()=>v,l3:()=>p,w$:()=>m,z9:()=>w});var n=r(1083),a=function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}c((n=n.apply(e,t||[])).next())}))},i=function(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},o=function(e,t,r){if(r||2===arguments.length)for(var n,a=0,i=t.length;a<i;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},s=n.A.create({baseURL:"/api",timeout:3e4}),c=function(e,t){if(console.error("API Error:",e),n.A.isAxiosError(e)){var r=e;if(r.response){var a=r.response.data,i=a&&"object"==typeof a?a.error||a.message||JSON.stringify(a):"Ошибка сервера";throw new Error("".concat(t||"Ошибка API",": ").concat(i))}throw r.request?new Error("Сервер не отвечает. Проверьте соединение с интернетом"):new Error("Ошибка при выполнении запроса: ".concat(r.message))}throw new Error(t||"Неизвестная ошибка при запросе к API")},l=function(){return a(void 0,void 0,void 0,(function(){var e,t,r;return i(this,(function(n){switch(n.label){case 0:return console.log("Запрос отделов начат"),[4,s.get("/departments")];case 1:return e=n.sent(),console.log("Получен ответ по отделам:",e.data),t=e.data.items,console.log("Отделы (массив):",t),r=t.filter((function(e,t,r){return t===r.findIndex((function(t){return t.id===e.id}))})),console.log("Уникальные отделы после фильтрации:",r),[2,r]}}))}))},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,o([],e,!0),void 0,(function(e,t,r,n,a){var o;return void 0===e&&(e=1),void 0===t&&(t=20),i(this,(function(i){switch(i.label){case 0:return o={page:e,per_page:t},r&&(o.department_id=r),void 0!==n&&(o.is_active=n),a&&(o.search=a),[4,s.get("/employees",{params:o})];case 1:return[2,i.sent().data]}}))}))},d=function(){return a(void 0,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,s.get("/employees/with-open-records")];case 1:return[2,e.sent().data.items||[]]}}))}))},p=function(e){return a(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,s.get("/employees/".concat(e))];case 1:return[2,t.sent().data]}}))}))},h=function(e){return a(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,s.post("/employees",e)];case 1:return[2,t.sent().data]}}))}))},f=function(e,t){return a(void 0,void 0,void 0,(function(){var r,n;return i(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),console.log("Updating employee with data:",t),[4,s.put("/employees/".concat(e),t)];case 1:return r=a.sent(),console.log("Employee update response:",r.data),[2,r.data];case 2:throw n=a.sent(),console.error("Error updating employee:",n),n;case 3:return[2]}}))}))},m=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(void 0,o([],e,!0),void 0,(function(e,t,r,n,a){var o;return void 0===e&&(e=1),void 0===t&&(t=20),i(this,(function(i){switch(i.label){case 0:return o={page:e,per_page:t},r&&(o.employee_id=r),n&&(o.start_date=n),a&&(o.end_date=a),[4,s.get("/time-records",{params:o})];case 1:return[2,i.sent().data]}}))}))},v=function(e,t){return a(void 0,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,s.post("/time-records/check-in",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},g=function(e,t){return a(void 0,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,s.post("/time-records/check-out",{employee_id:e,description:t})];case 1:return[2,r.sent().data]}}))}))},y=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return a(void 0,o([e,t],r,!0),void 0,(function(e,t,r,n){var a,o,l;return void 0===r&&(r="employee"),i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),a={start_date:e,end_date:t,group_by:r},n&&(a.department_id=n),console.log("Request params for summary report:",a),[4,s.get("/reports/summary",{params:a})];case 1:if(o=i.sent(),console.log("Summary report API response:",o.data),!o.data||!o.data.period||!o.data.data)throw new Error("Неверный формат ответа от сервера");return[2,o.data];case 2:throw l=i.sent(),c(l,"Ошибка при получении сводного отчета"),l;case 3:return[2]}}))}))},b=function(e,t,r){return a(void 0,void 0,void 0,(function(){var n,a,o;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n={date:e},t&&(n.employee_id=t),r&&(n.department_id=r),console.log("Request params for daily report:",n),[4,s.get("/reports/daily",{params:n})];case 1:if(a=i.sent(),console.log("Daily report API response:",a.data),!a.data||!a.data.date||!a.data.records)throw new Error("Неверный формат ответа от сервера");return[2,a.data];case 2:throw o=i.sent(),c(o,"Ошибка при получении ежедневного отчета"),o;case 3:return[2]}}))}))},w=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return a(void 0,o([e,t],r,!0),void 0,(function(e,t,r,n){var a,o,l;return void 0===r&&(r="summary"),i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),a={start_date:e,end_date:t,type:r},n&&(a.department_id=n),console.log("Request params for CSV export:",a),[4,s.get("/reports/export/csv",{params:a})];case 1:if(o=i.sent(),console.log("CSV export response received"),!o.data||!o.data.csv_data||!o.data.filename)throw new Error("Неверный формат ответа от сервера при экспорте CSV");return[2,o.data];case 2:throw l=i.sent(),c(l,"Ошибка при экспорте CSV"),l;case 3:return[2]}}))}))}},5739:(e,t,r)=>{r.d(t,{EU:()=>a,Nl:()=>n,Qn:()=>i,V9:()=>o});var n=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Europe/Moscow"}).format(t)},a=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",timeZone:"Europe/Moscow"}).format(t)},i=function(){return(new Date).toLocaleDateString("ru-RU",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"Europe/Moscow"})},o=function(e){if(!e)return"";var t=new Date(e);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Europe/Moscow"}).format(t)}}}]);